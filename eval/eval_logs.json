[
  {
    "timestamp": "2026-01-30T20:27:29.376094",
    "agent_name": "fastapi_docs_agent",
    "system_prompt": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
    "model": "google-gla:gemini-2.0-flash-lite",
    "user_query": "How can I implement JWT-based authentication in FastAPI, including generating tokens and protecting routes?",
    "response": "The FastAPI documentation provides a comprehensive tutorial on implementing JWT-based authentication. Here's a breakdown of the key steps, based on the search results:\n\n**1. Installation**\n\n   *   Install `PyJWT` to generate and verify JWT tokens:\n       ```bash\n       pip install pyjwt\n       ```\n   *   If you plan to use digital signature algorithms like RSA or ECDSA, install the crypto dependencies:\n       ```bash\n       pip install pyjwt[crypto]\n       ```\n   *   Install `passlib` for password hashing:\n       ```bash\n       pip install passlib[bcrypt]\n       ```\n\n**2. Key Generation and Configuration**\n\n   *   Generate a secret key for signing the JWT tokens using a secure method like `openssl rand -hex 32`.  Store this key in a variable called `SECRET_KEY`.\n   *   Define the signing algorithm (e.g., `\"HS256\"`) in a variable `ALGORITHM`.\n   *   Set the token's expiration time.\n\n**3.  Implement Password Hashing**\n\n   *   Use a library like `passlib` with an algorithm such as Bcrypt to securely hash passwords before storing them.\n\n**4. Create a Token Endpoint**\n\n   *   Define a Pydantic model for the token endpoint's response, which should include an `access_token` and a `token_type` (e.g., \"bearer\").\n   *   Create a utility function to generate new access tokens.  This function will:\n        *   Receive user credentials (e.g., username and password).\n        *   Verify the user's credentials against your database (using password hashing to compare the provided password with the stored hash).\n        *   If the credentials are valid, create a JWT containing user information (like the username). The `sub` claim in the JWT is often used to store a unique user identifier.\n        *   Sign the JWT using the `SECRET_KEY` and the specified `ALGORITHM`.\n        *   Return the `access_token` and `token_type` in the response.\n\n**5. Protect Routes**\n\n   *   Create a dependency to decode and verify the JWT from the `Authorization` header of incoming requests. This dependency will:\n        *   Extract the token from the `Authorization` header (typically in the format \"Bearer <token>\").\n        *   Decode the token using `PyJWT`, verifying the signature against the `SECRET_KEY` and checking for expiration.\n        *   If the token is valid, retrieve the user information from the token (e.g., the username from the `sub` claim) and return the current user.\n        *   If the token is invalid, raise an HTTP error (e.g., 401 Unauthorized).\n   *   Apply this dependency to the routes you want to protect.  This ensures that only authenticated users can access those routes.\n\n**Example Code Snippets**\n\nThe documentation provides code examples for these steps. You can find them by searching the documentation for \"JWT\" and \"OAuth2\".  The tutorial on OAuth2 with password and JWT tokens (`/tutorial/security/oauth2-jwt`) is particularly relevant.\n",
    "messages": [
      {
        "parts": [
          {
            "content": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
            "timestamp": "2026-01-31 04:27:23.681727+00:00",
            "dynamic_ref": null,
            "part_kind": "system-prompt"
          },
          {
            "content": "How can I implement JWT-based authentication in FastAPI, including generating tokens and protecting routes?",
            "timestamp": "2026-01-31 04:27:23.681733+00:00",
            "part_kind": "user-prompt"
          }
        ],
        "timestamp": "2026-01-31 04:27:23.681863+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "260e7ccd-7527-43c8-902b-613183a8e0b9",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "args": {
              "query": "JWT authentication FastAPI"
            },
            "tool_call_id": "pyd_ai_eabb44906b3943c3895ec5f61749144c",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "tool-call"
          }
        ],
        "usage": {
          "input_tokens": 243,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 10,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 243,
            "text_candidates_tokens": 10
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:24.189210+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "q4R9aY6eMcOJqtsPi6vtyQc",
        "finish_reason": "stop",
        "run_id": "260e7ccd-7527-43c8-902b-613183a8e0b9",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "content": "[1] Source: fastapi-master/docs/zh/docs/tutorial/security/oauth2-jwt.md\nc/security/tutorial004_an_py310.py hl[8,49,56:57,60:61,70:76] *}\n\n/// note | \u7b14\u8bb0\n\n\u67e5\u770b\u65b0\u7684\uff08\u4f2a\uff09\u6570\u636e\u5e93 `fake_users_db`\uff0c\u5c31\u80fd\u770b\u5230\u54c8\u5e0c\u540e\u7684\u5bc6\u7801\uff1a`\"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW\"`\u3002\n\n///\n\n## \u5904\u7406 JWT \u4ee4\u724c\n\n\u5bfc\u5165\u5df2\u5b89\u88c5\u7684\u6a21\u5757\u3002\n\n\u521b\u5efa\u7528\u4e8e JWT \u4ee4\u724c\u7b7e\u540d\u7684\u968f\u673a\u5bc6\u94a5\u3002\n\n\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff0c\u751f\u6210\u5b89\u5168\u7684\u968f\u673a\u5bc6\u94a5\uff1a\n\n<div class=\"termy\">\n\n```console\n$ openssl rand -hex 32\n\n09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\n```\n\n</div>\n\n\u7136\u540e\uff0c\u628a\u751f\u6210\u7684\u5bc6\u94a5\u590d\u5236\u5230\u53d8\u91cf**SECRET_KEY**\uff0c\u6ce8\u610f\uff0c\u4e0d\u8981\u4f7f\u7528\u672c\u4f8b\u6240\u793a\u7684\u5bc6\u94a5\u3002\n\n\u521b\u5efa\u6307\u5b9a JWT \u4ee4\u724c\u7b7e\u540d\u7b97\u6cd5\u7684\u53d8\u91cf **ALGORITHM**\uff0c\u672c\u4f8b\u4e2d\u7684\u503c\u4e3a `\"HS256\"`\u3002\n\n\u521b\u5efa\u8bbe\u7f6e\u4ee4\u724c\u8fc7\u671f\u65f6\u95f4\u7684\u53d8\u91cf\u3002\n\n\u5b9a\u4e49\u4ee4\u724c\u7aef\u70b9\u54cd\u5e94\u7684 Pydantic \u6a21\u578b\u3002\n\n\u521b\u5efa\u751f\u6210\u65b0\u7684\u8bbf\u95ee\u4ee4\u724c\u7684\u5de5\u5177\u51fd\u6570\u3002\n\n{* ../../docs_src/security/tutorial004.py hl[6,12:14,28:30,78:86] *}\n\n## \u66f4\u65b0\u4f9d\u8d56\u9879\n\n\u66f4\u65b0 `get_current_user` \u4ee5\u63a5\u6536\u4e0e\u4e4b\u524d\u76f8\u540c\u7684\u4ee4\u724c\uff0c\u4f46\u8fd9\u91cc\u7528\u7684\u662f JWT \u4ee4\u724c\u3002\n\n\u89e3\u7801\u5e76\u6821\u9a8c\u63a5\u6536\u5230\u7684\u4ee4\u724c\uff0c\u7136\u540e\uff0c\u8fd4\u56de\u5f53\u524d\u7528\u6237\u3002\n\n\u5982\u679c\u4ee4\u724c\u65e0\u6548\uff0c\u5219\u76f4\u63a5\u8fd4\u56de HTTP \u9519\u8bef\u3002\n\n{* ../../docs_src/security/tutorial004_an_py310.py hl[4,7,13:15,29:31,79:87] *}\n\n## \u66f4\u65b0 `/token` *\u8def\u5f84\u64cd\u4f5c*\n\n\u7528\u4ee4\u724c\u8fc7\u671f\u65f6\u95f4\u521b\u5efa `timedelta` \u5bf9\u8c61\u3002\n\n\u521b\u5efa\u5e76\u8fd4\u56de\u771f\u6b63\u7684 JWT \u8bbf\u95ee\u4ee4\u724c\u3002\n\n{* ../../docs_src/security/tutorial004_an_py310.py hl[118:133] *}\n\n### JWT `sub` \u7684\u6280\u672f\u7ec6\u8282\n\nJWT \u89c4\u8303\u8fd8\u5305\u62ec `sub` \u952e\uff0c\u503c\u662f\u4ee4\u724c\u7684\u4e3b\u9898\u3002\n\n\u8be5\u952e\u662f\u53ef\u9009\u7684\uff0c\u4f46\u8981\u628a\u7528\u6237\u6807\u8bc6\u653e\u5728\u8fd9\u4e2a\u952e\u91cc\uff0c\u6240\u4ee5\u672c\u4f8b\u4f7f\u7528\u4e86\u8be5\u952e\u3002\n\n\u9664\u4e86\u8bc6\u522b\u7528\u6237\u4e0e\u8bb8\u53ef\u7528\u6237\u5728 API \u4e0a\u76f4\u63a5\u6267\u884c\u64cd\u4f5c\u4e4b\u5916\uff0cJWT \u8fd8\u53ef\u80fd\u7528\u4e8e\u5176\u5b83\u4e8b\u60c5\u3002\n\n\u4f8b\u5982\uff0c\u8bc6\u522b**\u6c7d\u8f66**\u6216**\u535a\u5ba2**\u3002\n\n\u63a5\u7740\uff0c\u4e3a\u5b9e\u4f53\u6dfb\u52a0\u6743\u9650\uff0c\u6bd4\u5982**\u9a7e\u9a76**\uff08\u6c7d\u8f66\uff09\u6216**\u7f16\u8f91**\uff08\u535a\u5ba2\uff09\u3002\n\n\u7136\u540e\uff0c\u628a JWT \u4ee4\u724c\u4ea4\u7ed9\u7528\u6237\uff08\u6216\u673a\u5668\u4eba\uff09\uff0c\u4ed6\u4eec\u5c31\u53ef\u4ee5\u6267\u884c\u9a7e\u9a76\u6c7d\u8f66\uff0c\u6216\u7f16\u8f91\u535a\u5ba2\u7b49\u64cd\u4f5c\u3002\u65e0\u9700\u6ce8\u518c\u8d26\u6237\uff0c\u53ea\u8981\u6709 API \u751f\u6210\u7684 JWT \u4ee4\u724c\u5c31\u53ef\u4ee5\u3002\n\n\u540c\u7406\uff0cJWT \u53ef\u4ee5\u7528\u4e8e\u66f4\u590d\u6742\u7684\u573a\u666f\u3002\n\n\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u591a\u4e2a\u5b9e\u4f53\u7684 ID \u53ef\u80fd\u662f\u76f8\u540c\u7684\uff0c\u4ee5 ID  `foo` \u4e3a\u4f8b\uff0c\u7528\u6237\u7684 ID \u662f `foo`\uff0c\u8f66\u7684 ID \u662f `foo`\uff0c\u535a\u5ba2\u7684 ID \u4e5f\u662f  `foo`\u3002\n\n\u4e3a\u4e86\u907f\u514d ID \u51b2\u7a81\uff0c\u5728\u7ed9\u7528\u6237\u521b\u5efa JWT \u4ee4\u724c\u65f6\uff0c\u53ef\u4ee5\u4e3a `sub` \u952e\u7684\u503c\u52a0\u4e0a\u524d\u7f00\uff0c\u4f8b\u5982 `username:`\u3002\u56e0\u6b64\uff0c\u5728\u672c\u4f8b\u4e2d\uff0c`sub` \u7684\u503c\u53ef\u4ee5\u662f\uff1a`username:johndoe`\u3002\n\n\u6ce8\u610f\uff0c\u5212\u91cd\u70b9\uff0c`sub` \u952e\u5728\u6574\u4e2a\u5e94\u7528\u4e2d\u5e94\u8be5\u53ea\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6\u7b26\uff0c\u800c\u4e14\u5e94\u8be5\u662f\u5b57\u7b26\u4e32\u3002\n\n## \u68c0\u67e5\n\n\u8fd0\u884c\u670d\u52a1\u5668\u5e76\u8bbf\u95ee\u6587\u6863\uff1a <a href=\"http://127.0.0.1:8000/do\n\n---\n\n[2] Source: fastapi-master/docs/zh/docs/tutorial/security/oauth2-jwt.md\n# OAuth2 \u5b9e\u73b0\u5bc6\u7801\u54c8\u5e0c\u4e0e Bearer  JWT \u4ee4\u724c\u9a8c\u8bc1\n\n\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u4e86\u6240\u6709\u5b89\u5168\u6d41\uff0c\u672c\u7ae0\u5b66\u4e60\u5982\u4f55\u4f7f\u7528 <abbr title=\"JSON Web Tokens\">JWT</abbr> \u4ee4\u724c\uff08Token\uff09\u548c\u5b89\u5168\u5bc6\u7801\u54c8\u5e0c\uff08Hash\uff09\u5b9e\u73b0\u771f\u6b63\u7684\u5b89\u5168\u673a\u5236\u3002\n\n\u672c\u7ae0\u7684\u793a\u4f8b\u4ee3\u7801\u771f\u6b63\u5b9e\u73b0\u4e86\u5728\u5e94\u7528\u7684\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u54c8\u5e0c\u5bc6\u7801\u7b49\u529f\u80fd\u3002\n\n\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u7d27\u63a5\u4e0a\u4e00\u7ae0\uff0c\u7ee7\u7eed\u5b8c\u5584\u5b89\u5168\u673a\u5236\u3002\n\n## JWT \u7b80\u4ecb\n\nJWT \u5373**JSON \u7f51\u7edc\u4ee4\u724c**\uff08JSON Web Tokens\uff09\u3002\n\nJWT \u662f\u4e00\u79cd\u5c06 JSON \u5bf9\u8c61\u7f16\u7801\u4e3a\u6ca1\u6709\u7a7a\u683c\uff0c\u4e14\u96be\u4ee5\u7406\u89e3\u7684\u957f\u5b57\u7b26\u4e32\u7684\u6807\u51c6\u3002JWT \u7684\u5185\u5bb9\u5982\u4e0b\u6240\u793a\uff1a\n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n```\n\nJWT \u5b57\u7b26\u4e32\u6ca1\u6709\u52a0\u5bc6\uff0c\u4efb\u4f55\u4eba\u90fd\u80fd\u7528\u5b83\u6062\u590d\u539f\u59cb\u4fe1\u606f\u3002\n\n\u4f46 JWT \u4f7f\u7528\u4e86\u7b7e\u540d\u673a\u5236\u3002\u63a5\u53d7\u4ee4\u724c\u65f6\uff0c\u53ef\u4ee5\u7528\u7b7e\u540d\u6821\u9a8c\u4ee4\u724c\u3002\n\n\u4f7f\u7528 JWT \u521b\u5efa\u6709\u6548\u671f\u4e3a\u4e00\u5468\u7684\u4ee4\u724c\u3002\u7b2c\u4e8c\u5929\uff0c\u7528\u6237\u6301\u4ee4\u724c\u518d\u6b21\u8bbf\u95ee\u65f6\uff0c\u4ecd\u4e3a\u767b\u5f55\u72b6\u6001\u3002\n\n\u4ee4\u724c\u4e8e\u4e00\u5468\u540e\u8fc7\u671f\uff0c\u5c4a\u65f6\uff0c\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\u5c31\u4f1a\u5931\u8d25\u3002\u53ea\u6709\u518d\u6b21\u767b\u5f55\uff0c\u624d\u80fd\u83b7\u5f97\u65b0\u7684\u4ee4\u724c\u3002\u5982\u679c\u7528\u6237\uff08\u6216\u7b2c\u4e09\u65b9\uff09\u7be1\u6539\u4ee4\u724c\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u56e0\u4e3a\u7b7e\u540d\u4e0d\u5339\u914d\u4f1a\u5bfc\u81f4\u8eab\u4efd\u9a8c\u8bc1\u5931\u8d25\u3002\n\n\u5982\u9700\u6df1\u5165\u4e86\u89e3 JWT \u4ee4\u724c\uff0c\u4e86\u89e3\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u8bf7\u53c2\u9605 <a href=\"https://jwt.io/\" class=\"external-link\" target=\"_blank\">https://jwt.io</a>\u3002\n\n## \u5b89\u88c5 `PyJWT`\n\n\u5b89\u88c5 `PyJWT`\uff0c\u5728 Python \u4e2d\u751f\u6210\u548c\u6821\u9a8c JWT \u4ee4\u724c\uff1a\n\n<div class=\"termy\">\n\n```console\n$ pip install pyjwt\n\n---> 100%\n```\n\n</div>\n\n/// info | \u8bf4\u660e\n\n\u5982\u679c\u60a8\u6253\u7b97\u4f7f\u7528\u7c7b\u4f3c RSA \u6216 ECDSA \u7684\u6570\u5b57\u7b7e\u540d\u7b97\u6cd5\uff0c\u60a8\u5e94\u8be5\u5b89\u88c5\u52a0\u5bc6\u5e93\u4f9d\u8d56\u9879 `pyjwt[crypto]`\u3002\n\n\u60a8\u53ef\u4ee5\u5728 <a href=\"https://pyjwt.readthedocs.io/en/latest/installation.html\" class=\"external-link\" target=\"_blank\">PyJWT Installation docs</a> \u83b7\u5f97\u66f4\u591a\u4fe1\u606f\u3002\n\n///\n\n## \u5bc6\u7801\u54c8\u5e0c\n\n**\u54c8\u5e0c**\u662f\u6307\u628a\u7279\u5b9a\u5185\u5bb9\uff08\u672c\u4f8b\u4e2d\u4e3a\u5bc6\u7801\uff09\u8f6c\u6362\u4e3a\u4e71\u7801\u5f62\u5f0f\u7684\u5b57\u8282\u5e8f\u5217\uff08\u5176\u5b9e\u5c31\u662f\u5b57\u7b26\u4e32\uff09\u3002\n\n\u6bcf\u6b21\u4f20\u5165\u5b8c\u5168\u76f8\u540c\u7684\u5185\u5bb9\u65f6\uff08\u6bd4\u5982\uff0c\u5b8c\u5168\u76f8\u540c\u7684\u5bc6\u7801\uff09\uff0c\u8fd4\u56de\u7684\u90fd\u662f\u5b8c\u5168\u76f8\u540c\u7684\u4e71\u7801\u3002\n\n\u4f46\u8fd9\u4e2a\u4e71\u7801\u65e0\u6cd5\u8f6c\u6362\u56de\u4f20\u5165\u7684\u5bc6\u7801\u3002\n\n### \u4e3a\u4ec0\u4e48\u4f7f\u7528\u5bc6\u7801\u54c8\u5e0c\n\n\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u5047\u5982\u6570\u636e\u5e93\u88ab\u76d7\uff0c\u7a83\u8d3c\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\uff0c\u5f97\u5230\u7684\u53ea\u662f\u54c8\u5e0c\u503c\u3002\n\n\u8fd9\u6837\u4e00\u6765\uff0c\u7a83\u8d3c\u5c31\u65e0\u6cd5\u5728\u5176\u5b83\u5e94\u7528\u4e2d\u4f7f\u7528\u7a83\u53d6\u7684\u5bc6\u7801\uff08\u8981\u77e5\u9053\uff0c\u5f88\u591a\u7528\u6237\u5728\u6240\u6709\u7cfb\u7edf\u4e2d\u90fd\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u7801\uff0c\u98ce\u9669\u8d85\u5927\uff09\u3002\n\n## \u5b89\u88c5 `passlib`\n\nPasslib \u662f\u5904\u7406\u5bc6\u7801\u54c8\u5e0c\u7684 Python \u5305\u3002\n\n\u5b83\u652f\u6301\u5f88\u591a\u5b89\u5168\u54c8\u5e0c\u7b97\u6cd5\u53ca\u914d\u5957\u5de5\u5177\u3002\n\n\u672c\u6559\u7a0b\u63a8\u8350\u7684\u7b97\u6cd5\u662f **Bcrypt**\u3002\n\n\u56e0\u6b64\uff0c\u8bf7\u5148\u5b89\u88c5\u9644\u5e26 Bcrypt \u7684 PassLib\uff1a\n\n<div class=\"termy\">\n\n```console\n$ pip install passlib[bcrypt\n\n---\n\n[3] Source: fastapi-master/docs/ru/docs/tutorial/security/oauth2-jwt.md\n# OAuth2 \u0441 \u043f\u0430\u0440\u043e\u043b\u0435\u043c (\u0438 \u0445\u0435\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435\u043c), Bearer \u0441 JWT-\u0442\u043e\u043a\u0435\u043d\u0430\u043c\u0438 { #oauth2-with-password-and-hashing-bearer-with-jwt-tokens }\n\n\u0422\u0435\u043f\u0435\u0440\u044c, \u043a\u043e\u0433\u0434\u0430 \u0443 \u043d\u0430\u0441 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0435\u043d\u0438\u044f \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438, \u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u0441\u0434\u0435\u043b\u0430\u0435\u043c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u044b\u043c, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u0442\u043e\u043a\u0435\u043d\u044b <abbr title=\"JSON Web Tokens \u2013 \u0432\u0435\u0431\u2011\u0442\u043e\u043a\u0435\u043d\u044b JSON\">JWT</abbr> \u0438 \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0435 \u0445\u0435\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u0435\u0439.\n\n\u042d\u0442\u043e\u0442 \u043a\u043e\u0434 \u043c\u043e\u0436\u043d\u043e \u0440\u0435\u0430\u043b\u044c\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0432 \u0441\u0432\u043e\u0435\u043c \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0438, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0442\u044c \u0445\u044d\u0448\u0438 \u043f\u0430\u0440\u043e\u043b\u0435\u0439 \u0432 \u0431\u0430\u0437\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u0438 \u0442.\u0434.\n\n\u041c\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u043c \u0440\u0430\u0437\u0431\u0438\u0440\u0430\u0442\u044c\u0441\u044f, \u043d\u0430\u0447\u0438\u043d\u0430\u044f \u0441 \u0442\u043e\u0433\u043e \u043c\u0435\u0441\u0442\u0430, \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u043e\u043c \u043e\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u043b\u0438\u0441\u044c \u0432 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0435\u0439 \u0433\u043b\u0430\u0432\u0435.\n\n## \u041f\u0440\u043e JWT { #about-jwt }\n\nJWT \u043e\u0437\u043d\u0430\u0447\u0430\u0435\u0442 \"JSON Web Tokens\".\n\n\u042d\u0442\u043e \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442 \u0434\u043b\u044f \u043a\u043e\u0434\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f JSON-\u043e\u0431\u044a\u0435\u043a\u0442\u0430 \u0432 \u0432\u0438\u0434\u0435 \u0434\u043b\u0438\u043d\u043d\u043e\u0439 \u0441\u0442\u0440\u043e\u043a\u0438 \u0431\u0435\u0437 \u043f\u0440\u043e\u0431\u0435\u043b\u043e\u0432. \u0412\u044b\u0433\u043b\u044f\u0434\u0438\u0442 \u044d\u0442\u043e \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c:\n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n```\n\n\u041e\u043d \u043d\u0435 \u0437\u0430\u0448\u0438\u0444\u0440\u043e\u0432\u0430\u043d, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043b\u044e\u0431\u043e\u0439 \u0447\u0435\u043b\u043e\u0432\u0435\u043a \u043c\u043e\u0436\u0435\u0442 \u0432\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u0438\u0437 \u0435\u0433\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u043c\u043e\u0433\u043e.\n\n\u041d\u043e \u043e\u043d \u043f\u043e\u0434\u043f\u0438\u0441\u0430\u043d. \u0421\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e, \u043a\u043e\u0433\u0434\u0430 \u0432\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u0442\u0435 \u0442\u043e\u043a\u0435\u043d, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0432\u044b \u044d\u043c\u0438\u0442\u0438\u0440\u043e\u0432\u0430\u043b\u0438 (\u0432\u044b\u0434\u0430\u0432\u0430\u043b\u0438), \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0443\u0431\u0435\u0434\u0438\u0442\u044c\u0441\u044f, \u0447\u0442\u043e \u044d\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0432\u044b \u0435\u0433\u043e \u044d\u043c\u0438\u0442\u0438\u0440\u043e\u0432\u0430\u043b\u0438.\n\n\u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c, \u043c\u043e\u0436\u043d\u043e \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0442\u043e\u043a\u0435\u043d \u0441\u043e \u0441\u0440\u043e\u043a\u043e\u043c \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f, \u0441\u043a\u0430\u0436\u0435\u043c, 1 \u043d\u0435\u0434\u0435\u043b\u044f. \u0410 \u043a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0432\u0435\u0440\u043d\u0435\u0442\u0441\u044f \u043d\u0430 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0434\u0435\u043d\u044c \u0441 \u0442\u0435\u043c \u0436\u0435 \u0442\u043e\u043a\u0435\u043d\u043e\u043c, \u0432\u044b \u0431\u0443\u0434\u0435\u0442\u0435 \u0437\u043d\u0430\u0442\u044c, \u0447\u0442\u043e \u043e\u043d \u0432\u0441\u0435 \u0435\u0449\u0435 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0432\u0430\u0448\u0435\u0439 \u0441\u0438\u0441\u0442\u0435\u043c\u0435.\n\n\u0427\u0435\u0440\u0435\u0437 \u043d\u0435\u0434\u0435\u043b\u044e \u0441\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0442\u043e\u043a\u0435\u043d\u0430 \u0438\u0441\u0442\u0435\u0447\u0435\u0442, \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u043e\u0432\u0430\u043d \u0438 \u0435\u043c\u0443 \u043f\u0440\u0438\u0434\u0435\u0442\u0441\u044f \u0437\u0430\u043d\u043e\u0432\u043e \u0432\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0443, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043d\u043e\u0432\u044b\u0439 \u0442\u043e\u043a\u0435\u043d. \u0410 \u0435\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c (\u0438\u043b\u0438 \u0442\u0440\u0435\u0442\u044c\u0435 \n\n---\n\n[4] Source: fastapi-master/docs/en/docs/how-to/authentication-error-status-code.md\n# Use Old 403 Authentication Error Status Codes { #use-old-403-authentication-error-status-codes }\n\nBefore FastAPI version `0.122.0`, when the integrated security utilities returned an error to the client after a failed authentication, they used the HTTP status code `403 Forbidden`.\n\nStarting with FastAPI version `0.122.0`, they use the more appropriate HTTP status code `401 Unauthorized`, and return a sensible `WWW-Authenticate` header in the response, following the HTTP specifications, <a href=\"https://datatracker.ietf.org/doc/html/rfc7235#section-3.1\" class=\"external-link\" target=\"_blank\">RFC 7235</a>, <a href=\"https://datatracker.ietf.org/doc/html/rfc9110#name-401-unauthorized\" class=\"external-link\" target=\"_blank\">RFC 9110</a>.\n\nBut if for some reason your clients depend on the old behavior, you can revert to it by overriding the method `make_not_authenticated_error` in your security classes.\n\nFor example, you can create a subclass of `HTTPBearer` that returns a `403 Forbidden` error instead of the default `401 Unauthorized` error:\n\n{* ../../docs_src/authentication_error_status_code/tutorial001_an_py39.py hl[9:13] *}\n\n/// tip\n\nNotice that the function returns the exception instance, it doesn't raise it. The raising is done in the rest of the internal code.\n\n///\n\n---\n\n[5] Source: fastapi-master/docs/pt/docs/tutorial/security/oauth2-jwt.md\n# OAuth2 com Senha (e hashing), Bearer com tokens JWT { #oauth2-with-password-and-hashing-bearer-with-jwt-tokens }\n\nAgora que temos todo o fluxo de seguran\u00e7a, vamos tornar a aplica\u00e7\u00e3o realmente segura, usando tokens <abbr title=\"JSON Web Tokens\">JWT</abbr> e hashing de senhas seguras.\n\nEste c\u00f3digo \u00e9 algo que voc\u00ea pode realmente usar na sua aplica\u00e7\u00e3o, salvar os hashes das senhas no seu banco de dados, etc.\n\nVamos come\u00e7ar de onde paramos no cap\u00edtulo anterior e increment\u00e1-lo.\n\n## Sobre o JWT { #about-jwt }\n\nJWT significa \"JSON Web Tokens\".\n\n\u00c9 um padr\u00e3o para codificar um objeto JSON em uma string longa e densa sem espa\u00e7os. Ele se parece com isso:\n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n```\n\nEle n\u00e3o \u00e9 criptografado, ent\u00e3o qualquer pessoa pode recuperar as informa\u00e7\u00f5es do seu conte\u00fado.\n\nMas ele \u00e9 assinado. Assim, quando voc\u00ea recebe um token que voc\u00ea emitiu, voc\u00ea pode verificar que foi realmente voc\u00ea quem o emitiu.\n\nDessa forma, voc\u00ea pode criar um token com um prazo de expira\u00e7\u00e3o, digamos, de 1 semana. E ent\u00e3o, quando o usu\u00e1rio voltar no dia seguinte com o token, voc\u00ea sabe que ele ainda est\u00e1 logado no seu sistema.\n\nDepois de uma semana, o token expirar\u00e1 e o usu\u00e1rio n\u00e3o estar\u00e1 autorizado, precisando fazer login novamente para obter um novo token. E se o usu\u00e1rio (ou uma terceira parte) tentar modificar o token para alterar a expira\u00e7\u00e3o, voc\u00ea seria capaz de descobrir is\n\n---\n\n[6] Source: fastapi-master/docs/en/docs/release-notes.md\nithub.com/tiangolo/fastapi/pull/1621) by [@tomarv2](https://github.com/tomarv2).\n* Update JWT docs to use Python-jose instead of PyJWT. Initial PR [#1610](https://github.com/tiangolo/fastapi/pull/1610) by [@asheux](https://github.com/asheux).\n* Fix/re-enable search bar in docs. PR [#1703](https://github.com/tiangolo/fastapi/pull/1703).\n* Auto-generate a \"server\" in OpenAPI `servers` when there's a `root_path` instead of prefixing all the `paths`:\n    * Add a new parameter for `FastAPI` classes: `root_path_in_servers` to disable the auto-generation of `servers`.\n    * New docs about `root_path` and `servers` in [Additional Servers](https://fastapi.tiangolo.com/advanced/behind-a-proxy/#additional-servers).\n    * Update OAuth2 examples to use a relative URL for `tokenUrl=\"token\"` to make sure those examples keep working as-is even when behind a reverse proxy.\n    * Initial PR [#1596](https://github.com/tiangolo/fastapi/pull/1596) by [@rkbeatss](https://github.com/rkbeatss).\n* Fix typo/link in External Links. PR [#1702](https://github.com/tiangolo/fastapi/pull/1702).\n* Update handling of [External Links](https://fastapi.tiangolo.com/external-links/) to use a data file and allow translating the headers without becoming obsolete quickly when new links are added. PR [#https://github.com/tiangolo/fastapi/pull/1701](https://github.com/tiangolo/fastapi/pull/1701).\n* Add external link [Machine learning model serving in Python using FastAPI and Streamlit](https://davidefiocco.github.io/2\n\n---\n\n[7] Source: fastapi-master/docs/de/docs/tutorial/security/oauth2-jwt.md\n# OAuth2 mit Passwort (und Hashing), Bearer mit JWT-Tokens { #oauth2-with-password-and-hashing-bearer-with-jwt-tokens }\n\nDa wir nun \u00fcber den gesamten Sicherheitsablauf verf\u00fcgen, machen wir die Anwendung tats\u00e4chlich sicher, indem wir <abbr title=\"JSON Web Tokens\">JWT</abbr>-Tokens und sicheres Passwort-Hashing verwenden.\n\nDiesen Code k\u00f6nnen Sie tats\u00e4chlich in Ihrer Anwendung verwenden, die Passwort-Hashes in Ihrer Datenbank speichern, usw.\n\nWir bauen auf dem vorherigen Kapitel auf.\n\n## \u00dcber JWT { #about-jwt }\n\nJWT bedeutet \u201eJSON Web Tokens\u201c.\n\nEs ist ein Standard, um ein JSON-Objekt in einem langen, kompakten String ohne Leerzeichen zu kodieren. Das sieht so aus:\n\n```\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n```\n\nDa er nicht verschl\u00fcsselt ist, kann jeder die Informationen aus dem Inhalt wiederherstellen.\n\nAber er ist signiert. Wenn Sie also einen von Ihnen gesendeten Token zur\u00fcckerhalten, k\u00f6nnen Sie \u00fcberpr\u00fcfen, ob Sie ihn tats\u00e4chlich gesendet haben.\n\nAuf diese Weise k\u00f6nnen Sie einen Token mit einer G\u00fcltigkeitsdauer von beispielsweise einer Woche erstellen. Und wenn der Benutzer am n\u00e4chsten Tag mit dem Token zur\u00fcckkommt, wissen Sie, dass der Benutzer immer noch bei Ihrem System angemeldet ist.\n\nNach einer Woche l\u00e4uft der Token ab und der Benutzer wird nicht autorisiert und muss sich erneut anmelden, um einen neuen Token zu erhalten. Und wenn der Benutzer (oder ein D\n\n---\n\n[8] Source: fastapi-master/docs/en/docs/release-notes.md\nl/security/oauth2-jwt.md`. PR [#12650](https://github.com/fastapi/fastapi/pull/12650) by [@OCE1960](https://github.com/OCE1960).\n* \ud83d\udcdd Update includes in `docs/vi/docs/tutorial/first-steps.md`. PR [#12754](https://github.com/fastapi/fastapi/pull/12754) by [@MxPy](https://github.com/MxPy).\n* \ud83d\udcdd Update includes for `docs/pt/docs/advanced/wsgi.md`. PR [#12769](https://github.com/fastapi/fastapi/pull/12769) by [@Nimitha-jagadeesha](https://github.com/Nimitha-jagadeesha).\n* \ud83d\udcdd Update includes for `docs/en/docs/tutorial/dependencies/dependencies-in-path-operation-decorators.md`. PR [#12815](https://github.com/fastapi/fastapi/pull/12815) by [@handabaldeep](https://github.com/handabaldeep).\n* \ud83d\udcdd Update includes for `docs/en/docs/tutorial/dependencies/classes-as-dependencies.md`. PR [#12813](https://github.com/fastapi/fastapi/pull/12813) by [@handabaldeep](https://github.com/handabaldeep).\n* \u270f\ufe0f Fix error in `docs/en/docs/tutorial/middleware.md`. PR [#12819](https://github.com/fastapi/fastapi/pull/12819) by [@alejsdev](https://github.com/alejsdev).\n* \ud83d\udcdd Update includes for `docs/en/docs/tutorial/security/get-current-user.md`. PR [#12645](https://github.com/fastapi/fastapi/pull/12645) by [@OCE1960](https://github.com/OCE1960).\n* \ud83d\udcdd Update includes for `docs/en/docs/tutorial/security/first-steps.md`. PR [#12643](https://github.com/fastapi/fastapi/pull/12643) by [@OCE1960](https://github.com/OCE1960).\n* \ud83d\udcdd Update includes in `docs/de/docs/advanced/additional-responses.md`. PR [#12821](https://git\n\n---\n\n[9] Source: fastapi-master/docs/en/docs/tutorial/security/simple-oauth2.md\ne going to just be completely insecure and return the same `username` as the token.\n\n/// tip\n\nIn the next chapter, you will see a real secure implementation, with password hashing and <abbr title=\"JSON Web Tokens\">JWT</abbr> tokens.\n\nBut for now, let's focus on the specific details we need.\n\n///\n\n{* ../../docs_src/security/tutorial003_an_py310.py hl[87] *}\n\n/// tip\n\nBy the spec, you should return a JSON with an `access_token` and a `token_type`, the same as in this example.\n\nThis is something that you have to do yourself in your code, and make sure you use those JSON keys.\n\nIt's almost the only thing that you have to remember to do correctly yourself, to be compliant with the specifications.\n\nFor the rest, **FastAPI** handles it for you.\n\n///\n\n## Update the dependencies { #update-the-dependencies }\n\nNow we are going to update our dependencies.\n\nWe want to get the `current_user` *only* if this user is active.\n\nSo, we create an additional dependency `get_current_active_user` that in turn uses `get_current_user` as a dependency.\n\nBoth of these dependencies will just return an HTTP error if the user doesn't exist, or if is inactive.\n\nSo, in our endpoint, we will only get a user if the user exists, was correctly authenticated, and is active:\n\n{* ../../docs_src/security/tutorial003_an_py310.py hl[58:66,69:74,94] *}\n\n/// info\n\nThe additional header `WWW-Authenticate` with value `Bearer` we are returning here is also part of the spec.\n\nAny HTTP (error) status code 401 \"UNAUTHORIZED\" \n\n---\n\n[10] Source: fastapi-master/docs/en/docs/tutorial/security/oauth2-jwt.md\nVu/P4uod1+Qof8h+1g7bbDlBID48Rc\"`.\n\n///\n\n## Handle JWT tokens { #handle-jwt-tokens }\n\nImport the modules installed.\n\nCreate a random secret key that will be used to sign the JWT tokens.\n\nTo generate a secure random secret key use the command:\n\n<div class=\"termy\">\n\n```console\n$ openssl rand -hex 32\n\n09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\n```\n\n</div>\n\nAnd copy the output to the variable `SECRET_KEY` (don't use the one in the example).\n\nCreate a variable `ALGORITHM` with the algorithm used to sign the JWT token and set it to `\"HS256\"`.\n\nCreate a variable for the expiration of the token.\n\nDefine a Pydantic Model that will be used in the token endpoint for the response.\n\nCreate a utility function to generate a new access token.\n\n{* ../../docs_src/security/tutorial004_an_py310.py hl[4,7,13:15,29:31,79:87] *}\n\n## Update the dependencies { #update-the-dependencies }\n\nUpdate `get_current_user` to receive the same token as before, but this time, using JWT tokens.\n\nDecode the received token, verify it, and return the current user.\n\nIf the token is invalid, return an HTTP error right away.\n\n{* ../../docs_src/security/tutorial004_an_py310.py hl[90:107] *}\n\n## Update the `/token` *path operation* { #update-the-token-path-operation }\n\nCreate a `timedelta` with the expiration time of the token.\n\nCreate a real JWT access token and return it.\n\n{* ../../docs_src/security/tutorial004_an_py310.py hl[118:133] *}\n\n### Technical details about the JWT \"subject\" `sub` { #techn",
            "tool_call_id": "pyd_ai_eabb44906b3943c3895ec5f61749144c",
            "metadata": null,
            "timestamp": "2026-01-31 04:27:24.255741+00:00",
            "part_kind": "tool-return"
          }
        ],
        "timestamp": "2026-01-31 04:27:24.256060+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "260e7ccd-7527-43c8-902b-613183a8e0b9",
        "metadata": null
      },
      {
        "parts": [
          {
            "content": "The FastAPI documentation provides a comprehensive tutorial on implementing JWT-based authentication. Here's a breakdown of the key steps, based on the search results:\n\n**1. Installation**\n\n   *   Install `PyJWT` to generate and verify JWT tokens:\n       ```bash\n       pip install pyjwt\n       ```\n   *   If you plan to use digital signature algorithms like RSA or ECDSA, install the crypto dependencies:\n       ```bash\n       pip install pyjwt[crypto]\n       ```\n   *   Install `passlib` for password hashing:\n       ```bash\n       pip install passlib[bcrypt]\n       ```\n\n**2. Key Generation and Configuration**\n\n   *   Generate a secret key for signing the JWT tokens using a secure method like `openssl rand -hex 32`.  Store this key in a variable called `SECRET_KEY`.\n   *   Define the signing algorithm (e.g., `\"HS256\"`) in a variable `ALGORITHM`.\n   *   Set the token's expiration time.\n\n**3.  Implement Password Hashing**\n\n   *   Use a library like `passlib` with an algorithm such as Bcrypt to securely hash passwords before storing them.\n\n**4. Create a Token Endpoint**\n\n   *   Define a Pydantic model for the token endpoint's response, which should include an `access_token` and a `token_type` (e.g., \"bearer\").\n   *   Create a utility function to generate new access tokens.  This function will:\n        *   Receive user credentials (e.g., username and password).\n        *   Verify the user's credentials against your database (using password hashing to compare the provided password with the stored hash).\n        *   If the credentials are valid, create a JWT containing user information (like the username). The `sub` claim in the JWT is often used to store a unique user identifier.\n        *   Sign the JWT using the `SECRET_KEY` and the specified `ALGORITHM`.\n        *   Return the `access_token` and `token_type` in the response.\n\n**5. Protect Routes**\n\n   *   Create a dependency to decode and verify the JWT from the `Authorization` header of incoming requests. This dependency will:\n        *   Extract the token from the `Authorization` header (typically in the format \"Bearer <token>\").\n        *   Decode the token using `PyJWT`, verifying the signature against the `SECRET_KEY` and checking for expiration.\n        *   If the token is valid, retrieve the user information from the token (e.g., the username from the `sub` claim) and return the current user.\n        *   If the token is invalid, raise an HTTP error (e.g., 401 Unauthorized).\n   *   Apply this dependency to the routes you want to protect.  This ensures that only authenticated users can access those routes.\n\n**Example Code Snippets**\n\nThe documentation provides code examples for these steps. You can find them by searching the documentation for \"JWT\" and \"OAuth2\".  The tutorial on OAuth2 with password and JWT tokens (`/tutorial/security/oauth2-jwt`) is particularly relevant.\n",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "text"
          }
        ],
        "usage": {
          "input_tokens": 5710,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 688,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 5710,
            "text_candidates_tokens": 688
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:29.355606+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "rIR9abrmF4DBqtsPjIOfwAQ",
        "finish_reason": "stop",
        "run_id": "260e7ccd-7527-43c8-902b-613183a8e0b9",
        "metadata": null
      }
    ],
    "source": "generated"
  },
  {
    "timestamp": "2026-01-30T20:27:36.051334",
    "agent_name": "fastapi_docs_agent",
    "system_prompt": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
    "model": "google-gla:gemini-2.0-flash-lite",
    "user_query": "What's the best approach to handle database migrations in a FastAPI application using SQLAlchemy?",
    "response": "The FastAPI documentation doesn't have a specific section dedicated to \"the best approach\" for database migrations. However, the documentation provides a tutorial on using SQLModel (which is built on top of SQLAlchemy) with FastAPI. You can find information about SQLModel and using it with FastAPI in the SQLModel documentation and in the FastAPI tutorial on SQL databases.\n",
    "messages": [
      {
        "parts": [
          {
            "content": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
            "timestamp": "2026-01-31 04:27:34.383000+00:00",
            "dynamic_ref": null,
            "part_kind": "system-prompt"
          },
          {
            "content": "What's the best approach to handle database migrations in a FastAPI application using SQLAlchemy?",
            "timestamp": "2026-01-31 04:27:34.383005+00:00",
            "part_kind": "user-prompt"
          }
        ],
        "timestamp": "2026-01-31 04:27:34.383162+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "35e3ab30-7fe7-44cf-a3ea-0048ba82fdd0",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "args": {
              "query": "database migrations SQLAlchemy FastAPI"
            },
            "tool_call_id": "pyd_ai_05edb81515754476ab874c0161f09eb5",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "tool-call"
          }
        ],
        "usage": {
          "input_tokens": 242,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 11,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 242,
            "text_candidates_tokens": 11
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:34.967053+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "toR9aZefH6qmmtkP-rrW4Qg",
        "finish_reason": "stop",
        "run_id": "35e3ab30-7fe7-44cf-a3ea-0048ba82fdd0",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "content": "[1] Source: fastapi-master/docs/en/docs/how-to/testing-database.md\n# Testing a Database { #testing-a-database }\n\nYou can study about databases, SQL, and SQLModel in the <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel docs</a>. \ud83e\udd13\n\nThere's a mini <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/\" class=\"external-link\" target=\"_blank\">tutorial on using SQLModel with FastAPI</a>. \u2728\n\nThat tutorial includes a section about <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/tests/\" class=\"external-link\" target=\"_blank\">testing SQL databases</a>. \ud83d\ude0e\n\n---\n\n[2] Source: fastapi-master/docs/de/docs/how-to/testing-database.md\n# Eine Datenbank testen { #testing-a-database }\n\nSie k\u00f6nnen sich \u00fcber Datenbanken, SQL und SQLModel in der <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">SQLModel-Dokumentation</a> informieren. \ud83e\udd13\n\nEs gibt ein kurzes <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/\" class=\"external-link\" target=\"_blank\">Tutorial zur Verwendung von SQLModel mit FastAPI</a>. \u2728\n\nDieses Tutorial enth\u00e4lt einen Abschnitt \u00fcber das <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/tests/\" class=\"external-link\" target=\"_blank\">Testen von SQL-Datenbanken</a>. \ud83d\ude0e\n\n---\n\n[3] Source: fastapi-master/docs/ru/docs/how-to/testing-database.md\n# \u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445 { #testing-a-database }\n\n\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0437\u0443\u0447\u0438\u0442\u044c \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445, SQL \u0438 SQLModel \u0432 <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430\u0446\u0438\u0438 SQLModel</a>. \ud83e\udd13\n\n\u0415\u0441\u0442\u044c \u043c\u0438\u043d\u0438-<a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/\" class=\"external-link\" target=\"_blank\">\u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u043e \u043f\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044e SQLModel \u0441 FastAPI</a>. \u2728\n\n\u0412 \u044d\u0442\u043e\u043c \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0441\u0442\u0432\u0435 \u0435\u0441\u0442\u044c \u0440\u0430\u0437\u0434\u0435\u043b \u043e <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/tests/\" class=\"external-link\" target=\"_blank\">\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 SQL-\u0431\u0430\u0437 \u0434\u0430\u043d\u043d\u044b\u0445</a>. \ud83d\ude0e\n\n---\n\n[4] Source: fastapi-master/docs/pt/docs/how-to/testing-database.md\n# Testando a Base de Dados { #testing-a-database }\n\nVoc\u00ea pode estudar sobre bases de dados, SQL e SQLModel na <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">documenta\u00e7\u00e3o de SQLModel</a>. \ud83e\udd13\n\nAqui tem um mini <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/\" class=\"external-link\" target=\"_blank\">tutorial de como usar SQLModel com FastAPI</a>. \u2728\n\nEsse tutorial inclui uma se\u00e7\u00e3o sobre <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/tests/\" class=\"external-link\" target=\"_blank\">testar bases de dados SQL</a>. \ud83d\ude0e\n\n---\n\n[5] Source: fastapi-master/docs/es/docs/how-to/testing-database.md\n# Probando una Base de Datos { #testing-a-database }\n\nPuedes estudiar sobre bases de datos, SQL y SQLModel en la <a href=\"https://sqlmodel.tiangolo.com/\" class=\"external-link\" target=\"_blank\">documentaci\u00f3n de SQLModel</a>. \ud83e\udd13\n\nHay un mini <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/\" class=\"external-link\" target=\"_blank\">tutorial sobre el uso de SQLModel con FastAPI</a>. \u2728\n\nEse tutorial incluye una secci\u00f3n sobre <a href=\"https://sqlmodel.tiangolo.com/tutorial/fastapi/tests/\" class=\"external-link\" target=\"_blank\">c\u00f3mo probar bases de datos SQL</a>. \ud83d\ude0e\n\n---\n\n[6] Source: fastapi-master/docs/en/docs/release-notes.md\nngolo/fastapi/pull/25) by [@euri10](https://github.com/euri10).\n\n* Add issue templates to simplify reporting bugs, getting help, etc: [#34](https://github.com/tiangolo/fastapi/pull/34).\n\n* Update example for the SQLAlchemy tutorial at [https://fastapi.tiangolo.com/tutorial/sql-databases/](https://fastapi.tiangolo.com/tutorial/sql-databases/) using middleware and database session attached to request.\n\n## 0.4.0\n\n* Add `openapi_prefix`, support for reverse proxy and mounting sub-applications. See the docs at [https://fastapi.tiangolo.com/advanced/sub-applications-proxy/](https://fastapi.tiangolo.com/advanced/sub-applications-proxy/): [#26](https://github.com/tiangolo/fastapi/pull/26) by [@kabirkhan](https://github.com/kabirkhan).\n\n* Update [docs/tutorial for SQLAlchemy](https://fastapi.tiangolo.com/tutorial/sql-databases/) including note about _DB Browser for SQLite_.\n\n## 0.3.0\n\n* Fix/add SQLAlchemy support, including ORM, and update [docs for SQLAlchemy](https://fastapi.tiangolo.com/tutorial/sql-databases/): [#30](https://github.com/tiangolo/fastapi/pull/30).\n\n## 0.2.1\n\n* Fix `jsonable_encoder` for Pydantic models with `Config` but without `json_encoders`: [#29](https://github.com/tiangolo/fastapi/pull/29).\n\n## 0.2.0\n\n* Fix typos in Security section: [#24](https://github.com/tiangolo/fastapi/pull/24) by [@kkinder](https://github.com/kkinder).\n\n* Add support for Pydantic custom JSON encoders: [#21](https://github.com/tiangolo/fastapi/pull/21) by [@euri10](https://github.com/euri\n\n---\n\n[7] Source: fastapi-master/docs/en/docs/release-notes.md\n@ooknimm](https://github.com/ooknimm).\n\n### Docs\n\n* \ud83d\udcdd Tweak wording in `help-fastapi.md`. PR [#11040](https://github.com/tiangolo/fastapi/pull/11040) by [@tiangolo](https://github.com/tiangolo).\n* \ud83d\udcdd Tweak docs for Behind a Proxy. PR [#11038](https://github.com/tiangolo/fastapi/pull/11038) by [@tiangolo](https://github.com/tiangolo).\n* \ud83d\udcdd Add External Link: 10 Tips for adding SQLAlchemy to FastAPI. PR [#11036](https://github.com/tiangolo/fastapi/pull/11036) by [@Donnype](https://github.com/Donnype).\n* \ud83d\udcdd Add External Link: Tips on migrating from Flask to FastAPI and vice-versa. PR [#11029](https://github.com/tiangolo/fastapi/pull/11029) by [@jtemporal](https://github.com/jtemporal).\n* \ud83d\udcdd Deprecate old tutorials: Peewee, Couchbase, encode/databases. PR [#10979](https://github.com/tiangolo/fastapi/pull/10979) by [@tiangolo](https://github.com/tiangolo).\n* \u270f\ufe0f Fix typo in `fastapi/security/oauth2.py`. PR [#10972](https://github.com/tiangolo/fastapi/pull/10972) by [@RafalSkolasinski](https://github.com/RafalSkolasinski).\n* \ud83d\udcdd Update `HTTPException` details in `docs/en/docs/tutorial/handling-errors.md`. PR [#5418](https://github.com/tiangolo/fastapi/pull/5418) by [@papb](https://github.com/papb).\n* \u270f\ufe0f A few tweaks in `docs/de/docs/tutorial/first-steps.md`. PR [#10959](https://github.com/tiangolo/fastapi/pull/10959) by [@nilslindemann](https://github.com/nilslindemann).\n* \u270f\ufe0f Fix link in `docs/en/docs/advanced/async-tests.md`. PR [#10960](https://github.com/tiangolo/fastapi/pull/10960) by\n\n---\n\n[8] Source: fastapi-master/docs/en/docs/release-notes.md\nub.com/fastapi/fastapi/pull/11942) by [@gitworkflows](https://github.com/gitworkflows).\n* \u2b06 Update sqlalchemy requirement from <1.4.43,>=1.3.18 to >=1.3.18,<2.0.33. PR [#11979](https://github.com/fastapi/fastapi/pull/11979) by [@dependabot[bot]](https://github.com/apps/dependabot).\n* \ud83d\udd0a Remove old ignore warnings. PR [#11950](https://github.com/fastapi/fastapi/pull/11950) by [@tiangolo](https://github.com/tiangolo).\n* \u2b06\ufe0f Upgrade griffe-typingdoc for the docs. PR [#12029](https://github.com/fastapi/fastapi/pull/12029) by [@tiangolo](https://github.com/tiangolo).\n* \ud83d\ude48 Add .coverage* to `.gitignore`. PR [#11940](https://github.com/fastapi/fastapi/pull/11940) by [@gitworkflows](https://github.com/gitworkflows).\n* \u2699\ufe0f Record and show test coverage contexts (what test covers which line). PR [#11518](https://github.com/fastapi/fastapi/pull/11518) by [@slafs](https://github.com/slafs).\n\n## 0.112.1\n\n### Upgrades\n\n* \u2b06\ufe0f Allow Starlette 0.38.x, update the pin to `>=0.37.2,<0.39.0`. PR [#11876](https://github.com/fastapi/fastapi/pull/11876) by [@musicinmybrain](https://github.com/musicinmybrain).\n\n### Docs\n\n* \ud83d\udcdd Update docs section about \"Don't Translate these Pages\". PR [#12022](https://github.com/fastapi/fastapi/pull/12022) by [@tiangolo](https://github.com/tiangolo).\n* \ud83d\udcdd Add documentation for non-translated pages and scripts to verify them. PR [#12020](https://github.com/fastapi/fastapi/pull/12020) by [@tiangolo](https://github.com/tiangolo).\n* \ud83d\udcdd Update docs about discussions questions. PR\n\n---\n\n[9] Source: fastapi-master/docs/en/docs/release-notes.md\nngolo.com/pt/). PR [#1300](https://github.com/tiangolo/fastapi/pull/1300) by [@Serrones](https://github.com/Serrones).\n* Re-word and clarify docs for extra info in fields. PR [#1299](https://github.com/tiangolo/fastapi/pull/1299) by [@chris-allnutt](https://github.com/chris-allnutt).\n* Make sure the `*` in short features in the docs is consistent (after `.`) in all languages. PR [#1424](https://github.com/tiangolo/fastapi/pull/1424).\n* Update order of execution for `get_db` in SQLAlchemy tutorial. PR [#1293](https://github.com/tiangolo/fastapi/pull/1293) by [@bcb](https://github.com/bcb).\n* Fix typos in Async docs. PR [#1423](https://github.com/tiangolo/fastapi/pull/1423).\n\n## 0.54.2\n\n* Add translation to Spanish for [Concurrency and async / await - Concurrencia y async / await](https://fastapi.tiangolo.com/es/async/). PR [#1290](https://github.com/tiangolo/fastapi/pull/1290) by [@alvaropernas](https://github.com/alvaropernas).\n* Remove obsolete vote link. PR [#1289](https://github.com/tiangolo/fastapi/pull/1289) by [@donhui](https://github.com/donhui).\n* Allow disabling docs UIs by just disabling OpenAPI with `openapi_url=None`. New example in docs: [Advanced: Conditional OpenAPI](https://fastapi.tiangolo.com/advanced/conditional-openapi/). PR [#1421](https://github.com/tiangolo/fastapi/pull/1421).\n* Add translation to Portuguese for [Benchmarks - Compara\u00e7\u00f5es](https://fastapi.tiangolo.com/pt/benchmarks/). PR [#1274](https://github.com/tiangolo/fastapi/pull/1274) by [@Serrone\n\n---\n\n[10] Source: fastapi-master/docs/en/docs/release-notes.md\n](https://github.com/dmontagu).\n    * PR [#344](https://github.com/tiangolo/fastapi/pull/344).\n\n## 0.30.1\n\n* Add section in docs about [External Links and Articles](https://fastapi.tiangolo.com/external-links/). PR [#341](https://github.com/tiangolo/fastapi/pull/341).\n\n* Remove `Pipfile.lock` from the repository as it is only used by FastAPI contributors (developers of FastAPI itself). See the PR for more details. PR [#340](https://github.com/tiangolo/fastapi/pull/340).\n\n* Update section about [Help FastAPI - Get Help](https://fastapi.tiangolo.com/help-fastapi/). PR [#339](https://github.com/tiangolo/fastapi/pull/339).\n\n* Refine internal type declarations to improve/remove Mypy errors in users' code. PR [#338](https://github.com/tiangolo/fastapi/pull/338).\n\n* Update and clarify [SQL tutorial with SQLAlchemy](https://fastapi.tiangolo.com/tutorial/sql-databases/). PR [#331](https://github.com/tiangolo/fastapi/pull/331) by [@mariacamilagl](https://github.com/mariacamilagl).\n\n* Add SQLite [online viewers to the docs](https://fastapi.tiangolo.com/tutorial/sql-databases/#interact-with-the-database-directly). PR [#330](https://github.com/tiangolo/fastapi/pull/330) by [@cyrilbois](https://github.com/cyrilbois).\n\n## 0.30.0\n\n* Add support for Pydantic's ORM mode:\n    * Updated documentation about SQL with SQLAlchemy, using Pydantic models with ORM mode, SQLAlchemy models with relations, separation of files, simplification of code and other changes. New docs: [SQL (Relational) Databases",
            "tool_call_id": "pyd_ai_05edb81515754476ab874c0161f09eb5",
            "metadata": null,
            "timestamp": "2026-01-31 04:27:35.051996+00:00",
            "part_kind": "tool-return"
          }
        ],
        "timestamp": "2026-01-31 04:27:35.052356+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "35e3ab30-7fe7-44cf-a3ea-0048ba82fdd0",
        "metadata": null
      },
      {
        "parts": [
          {
            "content": "The FastAPI documentation doesn't have a specific section dedicated to \"the best approach\" for database migrations. However, the documentation provides a tutorial on using SQLModel (which is built on top of SQLAlchemy) with FastAPI. You can find information about SQLModel and using it with FastAPI in the SQLModel documentation and in the FastAPI tutorial on SQL databases.\n",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "text"
          }
        ],
        "usage": {
          "input_tokens": 3886,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 71,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 3886,
            "text_candidates_tokens": 71
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:36.050828+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "t4R9aZXUCdbZqtsPgdKdyAM",
        "finish_reason": "stop",
        "run_id": "35e3ab30-7fe7-44cf-a3ea-0048ba82fdd0",
        "metadata": null
      }
    ],
    "source": "generated"
  },
  {
    "timestamp": "2026-01-30T20:27:44.369598",
    "agent_name": "fastapi_docs_agent",
    "system_prompt": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
    "model": "google-gla:gemini-2.0-flash-lite",
    "user_query": "Can you provide an example of how to use background tasks to send emails after a user registers?",
    "response": "Here's how to use background tasks to send emails after a user registers, based on the FastAPI documentation:\n\n1.  **Import `BackgroundTasks`**: Import `BackgroundTasks` from `fastapi`.\n2.  **Define a background task function**: Create a regular function (using `def`) or an asynchronous function (`async def`) that will handle sending the email. This function can accept parameters.\n3.  **Add the background task**: Inside your path operation function, include a parameter of type `BackgroundTasks`. Then, use `.add_task()` on this object, passing your email sending function and any necessary arguments.\n\nHere's an example:\n\n```python\nfrom fastapi import FastAPI, BackgroundTasks\n\napp = FastAPI()\n\ndef send_email(email: str, message: str):\n    # Simulate sending an email\n    print(f\"Sending email to {email} with message: {message}\")\n\n@app.post(\"/register\")\nasync def register_user(email: str, background_tasks: BackgroundTasks):\n    # Simulate user registration\n    background_tasks.add_task(send_email, email, message=\"Welcome to our platform!\")\n    return {\"message\": \"User registered. Check your email!\"}\n```\n\nIn this example:\n\n*   The `send_email` function simulates sending an email.\n*   The `register_user` function takes an `email` and a `BackgroundTasks` object as parameters.\n*   `.add_task()` is used to add `send_email` to the background tasks, passing the email address and a welcome message.\n\nWhen a user registers (by sending a POST request to `/register`), the API immediately returns a response. Then, in the background, the `send_email` function is executed to send the email.\n",
    "messages": [
      {
        "parts": [
          {
            "content": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
            "timestamp": "2026-01-31 04:27:41.057623+00:00",
            "dynamic_ref": null,
            "part_kind": "system-prompt"
          },
          {
            "content": "Can you provide an example of how to use background tasks to send emails after a user registers?",
            "timestamp": "2026-01-31 04:27:41.057627+00:00",
            "part_kind": "user-prompt"
          }
        ],
        "timestamp": "2026-01-31 04:27:41.057772+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "a6f73751-a4df-48b6-b8bc-33c565d2c8c5",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "args": {
              "query": "background tasks send emails"
            },
            "tool_call_id": "pyd_ai_3d38b8d5be9f426fb92c9eb03e64c881",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "tool-call"
          }
        ],
        "usage": {
          "input_tokens": 244,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 11,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 244,
            "text_candidates_tokens": 11
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:41.584782+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "vYR9abvgC9C5qtsPw8vPgAQ",
        "finish_reason": "stop",
        "run_id": "a6f73751-a4df-48b6-b8bc-33c565d2c8c5",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "content": "[1] Source: fastapi-master/docs/en/docs/tutorial/background-tasks.md\n# Background Tasks { #background-tasks }\n\nYou can define background tasks to be run *after* returning a response.\n\nThis is useful for operations that need to happen after a request, but that the client doesn't really have to be waiting for the operation to complete before receiving the response.\n\nThis includes, for example:\n\n* Email notifications sent after performing an action:\n    * As connecting to an email server and sending an email tends to be \"slow\" (several seconds), you can return the response right away and send the email notification in the background.\n* Processing data:\n    * For example, let's say you receive a file that must go through a slow process, you can return a response of \"Accepted\" (HTTP 202) and process the file in the background.\n\n## Using `BackgroundTasks` { #using-backgroundtasks }\n\nFirst, import `BackgroundTasks` and define a parameter in your *path operation function* with a type declaration of `BackgroundTasks`:\n\n{* ../../docs_src/background_tasks/tutorial001_py39.py hl[1,13] *}\n\n**FastAPI** will create the object of type `BackgroundTasks` for you and pass it as that parameter.\n\n## Create a task function { #create-a-task-function }\n\nCreate a function to be run as the background task.\n\nIt is just a standard function that can receive parameters.\n\nIt can be an `async def` or normal `def` function, **FastAPI** will know how to handle it correctly.\n\nIn this case, the task function will write to a file (simulating sending an email).\n\nAnd as the write o\n\n---\n\n[2] Source: fastapi-master/docs/en/docs/tutorial/background-tasks.md\n function* will write a message using the `email` path parameter.\n\n## Technical Details { #technical-details }\n\nThe class `BackgroundTasks` comes directly from <a href=\"https://www.starlette.dev/background/\" class=\"external-link\" target=\"_blank\">`starlette.background`</a>.\n\nIt is imported/included directly into FastAPI so that you can import it from `fastapi` and avoid accidentally importing the alternative `BackgroundTask` (without the `s` at the end) from `starlette.background`.\n\nBy only using `BackgroundTasks` (and not `BackgroundTask`), it's then possible to use it as a *path operation function* parameter and have **FastAPI** handle the rest for you, just like when using the `Request` object directly.\n\nIt's still possible to use `BackgroundTask` alone in FastAPI, but you have to create the object in your code and return a Starlette `Response` including it.\n\nYou can see more details in <a href=\"https://www.starlette.dev/background/\" class=\"external-link\" target=\"_blank\">Starlette's official docs for Background Tasks</a>.\n\n## Caveat { #caveat }\n\nIf you need to perform heavy background computation and you don't necessarily need it to be run by the same process (for example, you don't need to share memory, variables, etc), you might benefit from using other bigger tools like <a href=\"https://docs.celeryq.dev\" class=\"external-link\" target=\"_blank\">Celery</a>.\n\nThey tend to require more complex configurations, a message/job queue manager, like RabbitMQ or Redis, but they allow \n\n---\n\n[3] Source: fastapi-master/docs/en/docs/tutorial/background-tasks.md\n001_py39.py hl[1,13] *}\n\n**FastAPI** will create the object of type `BackgroundTasks` for you and pass it as that parameter.\n\n## Create a task function { #create-a-task-function }\n\nCreate a function to be run as the background task.\n\nIt is just a standard function that can receive parameters.\n\nIt can be an `async def` or normal `def` function, **FastAPI** will know how to handle it correctly.\n\nIn this case, the task function will write to a file (simulating sending an email).\n\nAnd as the write operation doesn't use `async` and `await`, we define the function with normal `def`:\n\n{* ../../docs_src/background_tasks/tutorial001_py39.py hl[6:9] *}\n\n## Add the background task { #add-the-background-task }\n\nInside of your *path operation function*, pass your task function to the *background tasks* object with the method `.add_task()`:\n\n{* ../../docs_src/background_tasks/tutorial001_py39.py hl[14] *}\n\n`.add_task()` receives as arguments:\n\n* A task function to be run in the background (`write_notification`).\n* Any sequence of arguments that should be passed to the task function in order (`email`).\n* Any keyword arguments that should be passed to the task function (`message=\"some notification\"`).\n\n## Dependency Injection { #dependency-injection }\n\nUsing `BackgroundTasks` also works with the dependency injection system, you can declare a parameter of type `BackgroundTasks` at multiple levels: in a *path operation function*, in a dependency (dependable), in a sub-dependency, etc.\n\n**FastA\n\n---\n\n[4] Source: fastapi-master/docs/en/docs/tutorial/background-tasks.md\ntification`).\n* Any sequence of arguments that should be passed to the task function in order (`email`).\n* Any keyword arguments that should be passed to the task function (`message=\"some notification\"`).\n\n## Dependency Injection { #dependency-injection }\n\nUsing `BackgroundTasks` also works with the dependency injection system, you can declare a parameter of type `BackgroundTasks` at multiple levels: in a *path operation function*, in a dependency (dependable), in a sub-dependency, etc.\n\n**FastAPI** knows what to do in each case and how to reuse the same object, so that all the background tasks are merged together and are run in the background afterwards:\n\n\n{* ../../docs_src/background_tasks/tutorial002_an_py310.py hl[13,15,22,25] *}\n\n\nIn this example, the messages will be written to the `log.txt` file *after* the response is sent.\n\nIf there was a query in the request, it will be written to the log in a background task.\n\nAnd then another background task generated at the *path operation function* will write a message using the `email` path parameter.\n\n## Technical Details { #technical-details }\n\nThe class `BackgroundTasks` comes directly from <a href=\"https://www.starlette.dev/background/\" class=\"external-link\" target=\"_blank\">`starlette.background`</a>.\n\nIt is imported/included directly into FastAPI so that you can import it from `fastapi` and avoid accidentally importing the alternative `BackgroundTask` (without the `s` at the end) from `starlette.background`.\n\nBy only using\n\n---\n\n[5] Source: fastapi-master/docs/es/docs/tutorial/background-tasks.md\n response.\n\nSi hay un query en el request, se escribir\u00e1 en el log en una tarea en segundo plano.\n\nY luego otra tarea en segundo plano generada en la *path operation function* escribir\u00e1 un mensaje usando el par\u00e1metro de path `email`.\n\n## Detalles T\u00e9cnicos { #technical-details }\n\nLa clase `BackgroundTasks` proviene directamente de <a href=\"https://www.starlette.dev/background/\" class=\"external-link\" target=\"_blank\">`starlette.background`</a>.\n\nSe importa/incluye directamente en FastAPI para que puedas importarla desde `fastapi` y evitar importar accidentalmente la alternativa `BackgroundTask` (sin la `s` al final) de `starlette.background`.\n\nAl usar solo `BackgroundTasks` (y no `BackgroundTask`), es posible usarla como un par\u00e1metro de *path operation function* y dejar que **FastAPI** maneje el resto por ti, tal como cuando usas el objeto `Request` directamente.\n\nTodav\u00eda es posible usar `BackgroundTask` solo en FastAPI, pero debes crear el objeto en tu c\u00f3digo y devolver una `Response` de Starlette incluy\u00e9ndolo.\n\nPuedes ver m\u00e1s detalles en <a href=\"https://www.starlette.dev/background/\" class=\"external-link\" target=\"_blank\">la documentaci\u00f3n oficial de Starlette sobre Background Tasks</a>.\n\n## Advertencia { #caveat }\n\nSi necesitas realizar una computaci\u00f3n intensa en segundo plano y no necesariamente necesitas que se ejecute por el mismo proceso (por ejemplo, no necesitas compartir memoria, variables, etc.), podr\u00edas beneficiarte del uso de otras herramientas m\u00e1s grandes como <a hre\n\n---\n\n[6] Source: fastapi-master/docs/pt/docs/tutorial/background-tasks.md\n# Tarefas em segundo plano { #background-tasks }\n\nVoc\u00ea pode definir tarefas em segundo plano para serem executadas *ap\u00f3s* retornar uma resposta.\n\nIsso \u00e9 \u00fatil para opera\u00e7\u00f5es que precisam acontecer ap\u00f3s uma request, mas que o cliente n\u00e3o precisa realmente esperar a opera\u00e7\u00e3o terminar antes de receber a resposta.\n\nIsso inclui, por exemplo:\n\n* Notifica\u00e7\u00f5es por e-mail enviadas ap\u00f3s realizar uma a\u00e7\u00e3o:\n    * Como conectar-se a um servidor de e-mail e enviar um e-mail tende a ser \u201clento\u201d (v\u00e1rios segundos), voc\u00ea pode retornar a resposta imediatamente e enviar a notifica\u00e7\u00e3o por e-mail em segundo plano.\n* Processamento de dados:\n    * Por exemplo, digamos que voc\u00ea receba um arquivo que precisa passar por um processo lento; voc\u00ea pode retornar uma resposta \u201cAccepted\u201d (HTTP 202) e processar o arquivo em segundo plano.\n\n## Usando `BackgroundTasks` { #using-backgroundtasks }\n\nPrimeiro, importe `BackgroundTasks` e defina um par\u00e2metro na sua *fun\u00e7\u00e3o de opera\u00e7\u00e3o de rota* com uma declara\u00e7\u00e3o de tipo `BackgroundTasks`:\n\n{* ../../docs_src/background_tasks/tutorial001_py39.py hl[1,13] *}\n\nO **FastAPI** criar\u00e1 o objeto do tipo `BackgroundTasks` para voc\u00ea e o passar\u00e1 como esse par\u00e2metro.\n\n## Crie uma fun\u00e7\u00e3o de tarefa { #create-a-task-function }\n\nCrie uma fun\u00e7\u00e3o para ser executada como a tarefa em segundo plano.\n\n\u00c9 apenas uma fun\u00e7\u00e3o padr\u00e3o que pode receber par\u00e2metros.\n\nPode ser uma fun\u00e7\u00e3o `async def` ou um `def` normal, o **FastAPI** saber\u00e1 como lidar com isso corretamente.\n\nNeste caso, a fun\u00e7\u00e3o da tare\n\n---\n\n[7] Source: fastapi-master/docs/es/docs/tutorial/background-tasks.md\n de tipo de `BackgroundTasks`:\n\n{* ../../docs_src/background_tasks/tutorial001_py39.py hl[1,13] *}\n\n**FastAPI** crear\u00e1 el objeto de tipo `BackgroundTasks` por ti y lo pasar\u00e1 como ese par\u00e1metro.\n\n## Crear una funci\u00f3n de tarea { #create-a-task-function }\n\nCrea una funci\u00f3n para que se ejecute como la tarea en segundo plano.\n\nEs solo una funci\u00f3n est\u00e1ndar que puede recibir par\u00e1metros.\n\nPuede ser una funci\u00f3n `async def` o una funci\u00f3n normal `def`, **FastAPI** sabr\u00e1 c\u00f3mo manejarla correctamente.\n\nEn este caso, la funci\u00f3n de tarea escribir\u00e1 en un archivo (simulando el env\u00edo de un email).\n\nY como la operaci\u00f3n de escritura no usa `async` y `await`, definimos la funci\u00f3n con un `def` normal:\n\n{* ../../docs_src/background_tasks/tutorial001_py39.py hl[6:9] *}\n\n## Agregar la tarea en segundo plano { #add-the-background-task }\n\nDentro de tu *path operation function*, pasa tu funci\u00f3n de tarea al objeto de *background tasks* con el m\u00e9todo `.add_task()`:\n\n{* ../../docs_src/background_tasks/tutorial001_py39.py hl[14] *}\n\n`.add_task()` recibe como argumentos:\n\n* Una funci\u00f3n de tarea para ejecutar en segundo plano (`write_notification`).\n* Cualquier secuencia de argumentos que deba pasarse a la funci\u00f3n de tarea en orden (`email`).\n* Cualquier argumento de palabras clave que deba pasarse a la funci\u00f3n de tarea (`message=\"some notification\"`).\n\n## Inyecci\u00f3n de Dependencias { #dependency-injection }\n\nUsar `BackgroundTasks` tambi\u00e9n funciona con el sistema de inyecci\u00f3n de dependencias, puedes declarar u\n\n---\n\n[8] Source: fastapi-master/docs/es/docs/tutorial/background-tasks.md\n# Tareas en Segundo Plano { #background-tasks }\n\nPuedes definir tareas en segundo plano para que se ejecuten *despu\u00e9s* de devolver un response.\n\nEsto es \u00fatil para operaciones que necesitan ocurrir despu\u00e9s de un request, pero para las que el cliente realmente no necesita esperar a que la operaci\u00f3n termine antes de recibir el response.\n\nEsto incluye, por ejemplo:\n\n* Notificaciones por email enviadas despu\u00e9s de realizar una acci\u00f3n:\n  * Como conectarse a un servidor de email y enviar un email tiende a ser \"lento\" (varios segundos), puedes devolver el response de inmediato y enviar la notificaci\u00f3n por email en segundo plano.\n* Procesamiento de datos:\n  * Por ejemplo, supongamos que recibes un archivo que debe pasar por un proceso lento, puedes devolver un response de \"Accepted\" (HTTP 202) y procesar el archivo en segundo plano.\n\n## Usando `BackgroundTasks` { #using-backgroundtasks }\n\nPrimero, importa `BackgroundTasks` y define un par\u00e1metro en tu *path operation function* con una declaraci\u00f3n de tipo de `BackgroundTasks`:\n\n{* ../../docs_src/background_tasks/tutorial001_py39.py hl[1,13] *}\n\n**FastAPI** crear\u00e1 el objeto de tipo `BackgroundTasks` por ti y lo pasar\u00e1 como ese par\u00e1metro.\n\n## Crear una funci\u00f3n de tarea { #create-a-task-function }\n\nCrea una funci\u00f3n para que se ejecute como la tarea en segundo plano.\n\nEs solo una funci\u00f3n est\u00e1ndar que puede recibir par\u00e1metros.\n\nPuede ser una funci\u00f3n `async def` o una funci\u00f3n normal `def`, **FastAPI** sabr\u00e1 c\u00f3mo manejarla correctamente.\n\nEn es",
            "tool_call_id": "pyd_ai_3d38b8d5be9f426fb92c9eb03e64c881",
            "metadata": null,
            "timestamp": "2026-01-31 04:27:41.667325+00:00",
            "part_kind": "tool-return"
          }
        ],
        "timestamp": "2026-01-31 04:27:41.667621+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "a6f73751-a4df-48b6-b8bc-33c565d2c8c5",
        "metadata": null
      },
      {
        "parts": [
          {
            "content": "Here's how to use background tasks to send emails after a user registers, based on the FastAPI documentation:\n\n1.  **Import `BackgroundTasks`**: Import `BackgroundTasks` from `fastapi`.\n2.  **Define a background task function**: Create a regular function (using `def`) or an asynchronous function (`async def`) that will handle sending the email. This function can accept parameters.\n3.  **Add the background task**: Inside your path operation function, include a parameter of type `BackgroundTasks`. Then, use `.add_task()` on this object, passing your email sending function and any necessary arguments.\n\nHere's an example:\n\n```python\nfrom fastapi import FastAPI, BackgroundTasks\n\napp = FastAPI()\n\ndef send_email(email: str, message: str):\n    # Simulate sending an email\n    print(f\"Sending email to {email} with message: {message}\")\n\n@app.post(\"/register\")\nasync def register_user(email: str, background_tasks: BackgroundTasks):\n    # Simulate user registration\n    background_tasks.add_task(send_email, email, message=\"Welcome to our platform!\")\n    return {\"message\": \"User registered. Check your email!\"}\n```\n\nIn this example:\n\n*   The `send_email` function simulates sending an email.\n*   The `register_user` function takes an `email` and a `BackgroundTasks` object as parameters.\n*   `.add_task()` is used to add `send_email` to the background tasks, passing the email address and a welcome message.\n\nWhen a user registers (by sending a POST request to `/register`), the API immediately returns a response. Then, in the background, the `send_email` function is executed to send the email.\n",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "text"
          }
        ],
        "usage": {
          "input_tokens": 3407,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 384,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 3407,
            "text_candidates_tokens": 384
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:44.369093+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "vYR9aaTXL66nqtsPp6qgiAQ",
        "finish_reason": "stop",
        "run_id": "a6f73751-a4df-48b6-b8bc-33c565d2c8c5",
        "metadata": null
      }
    ],
    "source": "generated"
  },
  {
    "timestamp": "2026-01-30T20:27:52.718730",
    "agent_name": "fastapi_docs_agent",
    "system_prompt": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
    "model": "google-gla:gemini-2.0-flash-lite",
    "user_query": "How do I implement custom middleware in FastAPI to log request details (method, path, headers) before they reach the route handlers?",
    "response": "You can implement custom middleware in FastAPI using the `@app.middleware(\"http\")` decorator. The middleware function receives the `request` and a `call_next` function. The `call_next` function passes the request to the corresponding path operation and returns the response.\n\nHere's how you can log request details:\n\n```python\nfrom fastapi import FastAPI, Request\nfrom starlette.middleware.base import BaseHTTPMiddleware\nfrom starlette.responses import Response\nfrom starlette.types import ASGIApp\n\napp = FastAPI()\n\nclass RequestLoggingMiddleware(BaseHTTPMiddleware):\n    def __init__(self, app: ASGIApp):\n        super().__init__(app)\n\n    async def dispatch(self, request: Request, call_next):\n        print(f\"Request Method: {request.method}\")\n        print(f\"Request Path: {request.url.path}\")\n        print(\"Request Headers:\")\n        for name, value in request.headers.items():\n            print(f\"  {name}: {value}\")\n        response: Response = await call_next(request)\n        return response\n\napp.add_middleware(RequestLoggingMiddleware)\n\n@app.get(\"/\")\nasync def read_root():\n    return {\"message\": \"Hello World\"}\n```\n\nIn this example:\n\n1.  We define a `RequestLoggingMiddleware` class that inherits from `BaseHTTPMiddleware`.\n2.  Inside `dispatch`, we log the request method, path, and headers before calling `call_next(request)`.\n3.  `call_next(request)` passes the request to the next middleware or the route handler.\n4.  The response is then returned.\n\nThis middleware will log the request details for every incoming request before it reaches your route handlers.\n",
    "messages": [
      {
        "parts": [
          {
            "content": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
            "timestamp": "2026-01-31 04:27:49.375609+00:00",
            "dynamic_ref": null,
            "part_kind": "system-prompt"
          },
          {
            "content": "How do I implement custom middleware in FastAPI to log request details (method, path, headers) before they reach the route handlers?",
            "timestamp": "2026-01-31 04:27:49.375614+00:00",
            "part_kind": "user-prompt"
          }
        ],
        "timestamp": "2026-01-31 04:27:49.375741+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "ec3f95f0-d806-46f0-8478-60b3034f2045",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "args": {
              "query": "custom middleware logging request details"
            },
            "tool_call_id": "pyd_ai_3a94f08b8b6a47fab626bae1baf2b559",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "tool-call"
          }
        ],
        "usage": {
          "input_tokens": 251,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 12,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 251,
            "text_candidates_tokens": 12
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:49.885499+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "xYR9aYnFHt-Hz7IPxKygqA0",
        "finish_reason": "stop",
        "run_id": "ec3f95f0-d806-46f0-8478-60b3034f2045",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "content": "[1] Source: fastapi-master/docs/en/docs/tutorial/middleware.md\n# Middleware { #middleware }\n\nYou can add middleware to **FastAPI** applications.\n\nA \"middleware\" is a function that works with every **request** before it is processed by any specific *path operation*. And also with every **response** before returning it.\n\n* It takes each **request** that comes to your application.\n* It can then do something to that **request** or run any needed code.\n* Then it passes the **request** to be processed by the rest of the application (by some *path operation*).\n* It then takes the **response** generated by the application (by some *path operation*).\n* It can do something to that **response** or run any needed code.\n* Then it returns the **response**.\n\n/// note | Technical Details\n\nIf you have dependencies with `yield`, the exit code will run *after* the middleware.\n\nIf there were any background tasks (covered in the [Background Tasks](background-tasks.md){.internal-link target=_blank} section, you will see it later), they will run *after* all the middleware.\n\n///\n\n## Create a middleware { #create-a-middleware }\n\nTo create a middleware you use the decorator `@app.middleware(\"http\")` on top of a function.\n\nThe middleware function receives:\n\n* The `request`.\n* A function `call_next` that will receive the `request` as a parameter.\n    * This function will pass the `request` to the corresponding *path operation*.\n    * Then it returns the `response` generated by the corresponding *path operation*.\n* You can then further modify the `response` before r\n\n---\n\n[2] Source: fastapi-master/docs/en/docs/tutorial/middleware.md\nre.\n\n///\n\n## Create a middleware { #create-a-middleware }\n\nTo create a middleware you use the decorator `@app.middleware(\"http\")` on top of a function.\n\nThe middleware function receives:\n\n* The `request`.\n* A function `call_next` that will receive the `request` as a parameter.\n    * This function will pass the `request` to the corresponding *path operation*.\n    * Then it returns the `response` generated by the corresponding *path operation*.\n* You can then further modify the `response` before returning it.\n\n{* ../../docs_src/middleware/tutorial001_py39.py hl[8:9,11,14] *}\n\n/// tip\n\nKeep in mind that custom proprietary headers can be added <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers\" class=\"external-link\" target=\"_blank\">using the `X-` prefix</a>.\n\nBut if you have custom headers that you want a client in a browser to be able to see, you need to add them to your CORS configurations ([CORS (Cross-Origin Resource Sharing)](cors.md){.internal-link target=_blank}) using the parameter `expose_headers` documented in <a href=\"https://www.starlette.dev/middleware/#corsmiddleware\" class=\"external-link\" target=\"_blank\">Starlette's CORS docs</a>.\n\n///\n\n/// note | Technical Details\n\nYou could also use `from starlette.requests import Request`.\n\n**FastAPI** provides it as a convenience for you, the developer. But it comes directly from Starlette.\n\n///\n\n### Before and after the `response` { #before-and-after-the-response }\n\nYou can add code to be run with the `request`\n\n---\n\n[3] Source: fastapi-master/docs/es/docs/tutorial/middleware.md\n# Middleware { #middleware }\n\nPuedes a\u00f1adir middleware a las aplicaciones de **FastAPI**.\n\nUn \"middleware\" es una funci\u00f3n que trabaja con cada **request** antes de que sea procesada por cualquier *path operation* espec\u00edfica. Y tambi\u00e9n con cada **response** antes de devolverla.\n\n* Toma cada **request** que llega a tu aplicaci\u00f3n.\n* Puede entonces hacer algo a esa **request** o ejecutar cualquier c\u00f3digo necesario.\n* Luego pasa la **request** para que sea procesada por el resto de la aplicaci\u00f3n (por alguna *path operation*).\n* Despu\u00e9s toma la **response** generada por la aplicaci\u00f3n (por alguna *path operation*).\n* Puede hacer algo a esa **response** o ejecutar cualquier c\u00f3digo necesario.\n* Luego devuelve la **response**.\n\n/// note | Detalles T\u00e9cnicos\n\nSi tienes dependencias con `yield`, el c\u00f3digo de salida se ejecutar\u00e1 *despu\u00e9s* del middleware.\n\nSi hubiera tareas en segundo plano (cubiertas en la secci\u00f3n [Tareas en segundo plano](background-tasks.md){.internal-link target=_blank}, lo ver\u00e1s m\u00e1s adelante), se ejecutar\u00e1n *despu\u00e9s* de todo el middleware.\n\n///\n\n## Crear un middleware { #create-a-middleware }\n\nPara crear un middleware usas el decorador `@app.middleware(\"http\")` encima de una funci\u00f3n.\n\nLa funci\u00f3n middleware recibe:\n\n* La `request`.\n* Una funci\u00f3n `call_next` que recibir\u00e1 la `request` como par\u00e1metro.\n    * Esta funci\u00f3n pasar\u00e1 la `request` a la correspondiente *path operation*.\n    * Luego devuelve la `response` generada por la correspondiente *path operation*.\n* Puedes en\n\n---\n\n[4] Source: fastapi-master/docs/ru/docs/tutorial/middleware.md\nerf_counter()`</a> \u0432\u043c\u0435\u0441\u0442\u043e `time.time()` \u0434\u043b\u044f \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0435\u043d\u0438\u044f \u0431\u043e\u043b\u044c\u0448\u0435\u0439 \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u0438 \u043d\u0430\u0448\u0438\u0445 \u043f\u0440\u0438\u043c\u0435\u0440\u043e\u0432. \ud83e\udd13\n\n///\n\n## \u041f\u043e\u0440\u044f\u0434\u043e\u043a \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 middleware { #multiple-middleware-execution-order }\n\n\u041a\u043e\u0433\u0434\u0430 \u0432\u044b \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u0442\u0435 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e middleware \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0434\u0435\u043a\u043e\u0440\u0430\u0442\u043e\u0440\u0430 `@app.middleware()` \u0438\u043b\u0438 \u043c\u0435\u0442\u043e\u0434\u0430 `app.add_middleware()`, \u043a\u0430\u0436\u0434\u043e\u0435 \u043d\u043e\u0432\u043e\u0435 middleware \u043e\u0431\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u0435\u0442 \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435, \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u044f \u0441\u0442\u0435\u043a. \u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043d\u043e\u0435 middleware \u2014 \u0441\u0430\u043c\u043e\u0435 \u0432\u043d\u0435\u0448\u043d\u0435\u0435 (*outermost*), \u0430 \u043f\u0435\u0440\u0432\u043e\u0435 \u2014 \u0441\u0430\u043c\u043e\u0435 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0435 (*innermost*).\n\n\u041d\u0430 \u043f\u0443\u0442\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u0441\u0430\u043c\u043e\u0435 \u0432\u043d\u0435\u0448\u043d\u0435\u0435 middleware.\n\n\u041d\u0430 \u043f\u0443\u0442\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u043e\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c.\n\n\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440:\n\n```Python\napp.add_middleware(MiddlewareA)\napp.add_middleware(MiddlewareB)\n```\n\n\u042d\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u0442 \u043a \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c\u0443 \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f:\n\n* **\u0417\u0430\u043f\u0440\u043e\u0441**: MiddlewareB \u2192 MiddlewareA \u2192 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\n\n* **\u041e\u0442\u0432\u0435\u0442**: \u043c\u0430\u0440\u0448\u0440\u0443\u0442 \u2192 MiddlewareA \u2192 MiddlewareB\n\n\u0422\u0430\u043a\u043e\u0435 \u0441\u0442\u0435\u043a\u043e\u0432\u043e\u0435 \u043f\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u0435 \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0432\u0430\u0435\u0442 \u043f\u0440\u0435\u0434\u0441\u043a\u0430\u0437\u0443\u0435\u043c\u044b\u0439 \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u043c\u044b\u0439 \u043f\u043e\u0440\u044f\u0434\u043e\u043a \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f middleware.\n\n## \u0414\u0440\u0443\u0433\u0438\u0435 middleware { #other-middlewares }\n\n\u041e \u0434\u0440\u0443\u0433\u0438\u0445 middleware \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0443\u0437\u043d\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b\u0435 [Advanced User Guide: Advanced Middleware](../advanced/middleware.md){.internal-link target=_blank}.\n\n\u0412 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u0435 \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c, \u043a\u0430\u043a \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u0442\u044c <abbr title=\"Cross-Origin Resource Sharing \u2013 \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u043d\u043e\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u043e\u0432 \u043c\u0435\u0436\u0434\u0443 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430\u043c\u0438\">CORS</abbr> \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e middleware.\n\n---\n\n[5] Source: fastapi-master/docs/es/docs/tutorial/middleware.md\n m\u00e1s adelante), se ejecutar\u00e1n *despu\u00e9s* de todo el middleware.\n\n///\n\n## Crear un middleware { #create-a-middleware }\n\nPara crear un middleware usas el decorador `@app.middleware(\"http\")` encima de una funci\u00f3n.\n\nLa funci\u00f3n middleware recibe:\n\n* La `request`.\n* Una funci\u00f3n `call_next` que recibir\u00e1 la `request` como par\u00e1metro.\n    * Esta funci\u00f3n pasar\u00e1 la `request` a la correspondiente *path operation*.\n    * Luego devuelve la `response` generada por la correspondiente *path operation*.\n* Puedes entonces modificar a\u00fan m\u00e1s la `response` antes de devolverla.\n\n{* ../../docs_src/middleware/tutorial001_py39.py hl[8:9,11,14] *}\n\n/// tip | Consejo\n\nTen en cuenta que los custom proprietary headers se pueden a\u00f1adir <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers\" class=\"external-link\" target=\"_blank\">usando el prefijo `X-`</a>.\n\nPero si tienes custom headers que deseas que un cliente en un navegador pueda ver, necesitas a\u00f1adirlos a tus configuraciones de CORS ([CORS (Cross-Origin Resource Sharing)](cors.md){.internal-link target=_blank}) usando el par\u00e1metro `expose_headers` documentado en <a href=\"https://www.starlette.dev/middleware/#corsmiddleware\" class=\"external-link\" target=\"_blank\">la documentaci\u00f3n de CORS de Starlette</a>.\n\n///\n\n/// note | Detalles T\u00e9cnicos\n\nTambi\u00e9n podr\u00edas usar `from starlette.requests import Request`.\n\n**FastAPI** lo proporciona como una conveniencia para ti, el desarrollador. Pero viene directamente de Starlette.\n\n///\n\n### Antes y despu\u00e9s de \n\n---\n\n[6] Source: fastapi-master/docs/de/docs/tutorial/middleware.md\n# Middleware { #middleware }\n\nSie k\u00f6nnen Middleware zu **FastAPI**-Anwendungen hinzuf\u00fcgen.\n\nEine \u201eMiddleware\u201c ist eine Funktion, die mit jedem **<abbr title=\"Request \u2013 Anfrage: Daten, die der Client zum Server sendet\">Request</abbr>** arbeitet, bevor er von einer bestimmten *Pfadoperation* verarbeitet wird. Und auch mit jeder **<abbr title=\"Response \u2013 Antwort: Daten, die der Server zum anfragenden Client zur\u00fccksendet\">Response</abbr>**, bevor sie zur\u00fcckgegeben wird.\n\n* Sie nimmt jeden **Request** entgegen, der an Ihre Anwendung gesendet wird.\n* Sie kann dann etwas mit diesem **Request** tun oder beliebigen Code ausf\u00fchren.\n* Dann gibt sie den **Request** zur Verarbeitung durch den Rest der Anwendung weiter (durch eine bestimmte *Pfadoperation*).\n* Sie nimmt dann die **Response** entgegen, die von der Anwendung generiert wurde (durch eine bestimmte *Pfadoperation*).\n* Sie kann etwas mit dieser **Response** tun oder beliebigen Code ausf\u00fchren.\n* Dann gibt sie die **Response** zur\u00fcck.\n\n/// note | Technische Details\n\nWenn Sie Abh\u00e4ngigkeiten mit `yield` haben, wird der Exit-Code *nach* der Middleware ausgef\u00fchrt.\n\nWenn es Hintergrundtasks gab (dies wird sp\u00e4ter im [Hintergrundtasks](background-tasks.md){.internal-link target=_blank}-Abschnitt behandelt), werden sie *nach* allen Middlewares ausgef\u00fchrt.\n\n///\n\n## Eine Middleware erstellen { #create-a-middleware }\n\nUm eine Middleware zu erstellen, verwenden Sie den Dekorator `@app.middleware(\"http\")` \u00fcber einer Funktion.\n\nDie Middleware-F\n\n---\n\n[7] Source: fastapi-master/docs/de/docs/tutorial/middleware.md\n *Pfadoperation* empfangen wird.\n\nUnd auch nachdem die `response` generiert wurde, bevor sie zur\u00fcckgegeben wird.\n\nSie k\u00f6nnten beispielsweise einen benutzerdefinierten Header `X-Process-Time` hinzuf\u00fcgen, der die Zeit in Sekunden enth\u00e4lt, die ben\u00f6tigt wurde, um den Request zu verarbeiten und eine Response zu generieren:\n\n{* ../../docs_src/middleware/tutorial001_py39.py hl[10,12:13] *}\n\n/// tip | Tipp\n\nHier verwenden wir <a href=\"https://docs.python.org/3/library/time.html#time.perf_counter\" class=\"external-link\" target=\"_blank\">`time.perf_counter()`</a> anstelle von `time.time()`, da es f\u00fcr diese Anwendungsf\u00e4lle pr\u00e4ziser sein kann. \ud83e\udd13\n\n///\n\n## Ausf\u00fchrungsreihenfolge bei mehreren Middlewares { #multiple-middleware-execution-order }\n\nWenn Sie mehrere Middlewares hinzuf\u00fcgen, entweder mit dem `@app.middleware()` Dekorator oder der Methode `app.add_middleware()`, umschlie\u00dft jede neue Middleware die Anwendung und bildet einen Stapel. Die zuletzt hinzugef\u00fcgte Middleware ist die *\u00e4u\u00dferste*, und die erste ist die *innerste*.\n\nAuf dem Requestpfad l\u00e4uft die *\u00e4u\u00dferste* Middleware zuerst.\n\nAuf dem Responsepfad l\u00e4uft sie zuletzt.\n\nZum Beispiel:\n\n```Python\napp.add_middleware(MiddlewareA)\napp.add_middleware(MiddlewareB)\n```\n\nDies f\u00fchrt zu folgender Ausf\u00fchrungsreihenfolge:\n\n* **Request**: MiddlewareB \u2192 MiddlewareA \u2192 Route\n\n* **Response**: Route \u2192 MiddlewareA \u2192 MiddlewareB\n\nDieses Stapelverhalten stellt sicher, dass Middlewares in einer vorhersehbaren und kontrollierbaren Reihenfolge ausgef\u00fchrt w\n\n---\n\n[8] Source: fastapi-master/docs/de/docs/tutorial/middleware.md\nnote | Technische Details\n\nWenn Sie Abh\u00e4ngigkeiten mit `yield` haben, wird der Exit-Code *nach* der Middleware ausgef\u00fchrt.\n\nWenn es Hintergrundtasks gab (dies wird sp\u00e4ter im [Hintergrundtasks](background-tasks.md){.internal-link target=_blank}-Abschnitt behandelt), werden sie *nach* allen Middlewares ausgef\u00fchrt.\n\n///\n\n## Eine Middleware erstellen { #create-a-middleware }\n\nUm eine Middleware zu erstellen, verwenden Sie den Dekorator `@app.middleware(\"http\")` \u00fcber einer Funktion.\n\nDie Middleware-Funktion erh\u00e4lt:\n\n* Den `request`.\n* Eine Funktion `call_next`, die den `request` als Parameter erh\u00e4lt.\n    * Diese Funktion gibt den `request` an die entsprechende *Pfadoperation* weiter.\n    * Dann gibt es die von der entsprechenden *Pfadoperation* generierte `response` zur\u00fcck.\n* Sie k\u00f6nnen die `response` dann weiter modifizieren, bevor Sie sie zur\u00fcckgeben.\n\n{* ../../docs_src/middleware/tutorial001_py39.py hl[8:9,11,14] *}\n\n/// tip | Tipp\n\nBeachten Sie, dass benutzerdefinierte propriet\u00e4re Header hinzugef\u00fcgt werden k\u00f6nnen <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers\" class=\"external-link\" target=\"_blank\">unter Verwendung des `X-`-Pr\u00e4fixes</a>.\n\nWenn Sie jedoch benutzerdefinierte Header haben, die ein Client in einem Browser sehen soll, m\u00fcssen Sie sie zu Ihrer CORS-Konfiguration ([CORS (Cross-Origin Resource Sharing)](cors.md){.internal-link target=_blank}) hinzuf\u00fcgen, indem Sie den Parameter `expose_headers` verwenden, der in der <a href=\"https://www.starlette.dev\n\n---\n\n[9] Source: fastapi-master/docs/pt/docs/tutorial/middleware.md\n# Middleware { #middleware }\n\nVoc\u00ea pode adicionar middleware \u00e0 suas aplica\u00e7\u00f5es **FastAPI**.\n\nUm \"middleware\" \u00e9 uma fun\u00e7\u00e3o que manipula cada **requisi\u00e7\u00e3o** antes de ser processada por qualquer *opera\u00e7\u00e3o de rota* espec\u00edfica. E tamb\u00e9m cada **resposta** antes de retorn\u00e1-la.\n\n* Ele pega cada **requisi\u00e7\u00e3o** que chega ao seu aplicativo.\n* Ele pode ent\u00e3o fazer algo com essa **requisi\u00e7\u00e3o** ou executar qualquer c\u00f3digo necess\u00e1rio.\n* Ent\u00e3o ele passa a **requisi\u00e7\u00e3o** para ser processada pelo resto do aplicativo (por alguma *opera\u00e7\u00e3o de rota*).\n* Ele ent\u00e3o pega a **resposta** gerada pelo aplicativo (por alguma *opera\u00e7\u00e3o de rota*).\n* Ele pode fazer algo com essa **resposta** ou executar qualquer c\u00f3digo necess\u00e1rio.\n* Ent\u00e3o ele retorna a **resposta**.\n\n/// note | Detalhes T\u00e9cnicos\n\nSe voc\u00ea tiver depend\u00eancias com `yield`, o c\u00f3digo de sa\u00edda ser\u00e1 executado *depois* do middleware.\n\nSe houver alguma tarefa em segundo plano (abordada na se\u00e7\u00e3o [Tarefas em segundo plano](background-tasks.md){.internal-link target=_blank}, que voc\u00ea ver\u00e1 mais adiante), ela ser\u00e1 executada *depois* de todo o middleware.\n\n///\n\n## Criar um middleware { #create-a-middleware }\n\nPara criar um middleware, use o decorador `@app.middleware(\"http\")` logo acima de uma fun\u00e7\u00e3o.\n\nA fun\u00e7\u00e3o middleware recebe:\n\n* A `request`.\n* Uma fun\u00e7\u00e3o `call_next` que receber\u00e1 o `request` como um par\u00e2metro.\n    * Esta fun\u00e7\u00e3o passar\u00e1 a `request` para a *opera\u00e7\u00e3o de rota* correspondente.\n    * Ent\u00e3o ela retorna a `response` gerada pela *opera\u00e7\u00e3o de rot",
            "tool_call_id": "pyd_ai_3a94f08b8b6a47fab626bae1baf2b559",
            "metadata": null,
            "timestamp": "2026-01-31 04:27:49.974964+00:00",
            "part_kind": "tool-return"
          }
        ],
        "timestamp": "2026-01-31 04:27:49.975287+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "ec3f95f0-d806-46f0-8478-60b3034f2045",
        "metadata": null
      },
      {
        "parts": [
          {
            "content": "You can implement custom middleware in FastAPI using the `@app.middleware(\"http\")` decorator. The middleware function receives the `request` and a `call_next` function. The `call_next` function passes the request to the corresponding path operation and returns the response.\n\nHere's how you can log request details:\n\n```python\nfrom fastapi import FastAPI, Request\nfrom starlette.middleware.base import BaseHTTPMiddleware\nfrom starlette.responses import Response\nfrom starlette.types import ASGIApp\n\napp = FastAPI()\n\nclass RequestLoggingMiddleware(BaseHTTPMiddleware):\n    def __init__(self, app: ASGIApp):\n        super().__init__(app)\n\n    async def dispatch(self, request: Request, call_next):\n        print(f\"Request Method: {request.method}\")\n        print(f\"Request Path: {request.url.path}\")\n        print(\"Request Headers:\")\n        for name, value in request.headers.items():\n            print(f\"  {name}: {value}\")\n        response: Response = await call_next(request)\n        return response\n\napp.add_middleware(RequestLoggingMiddleware)\n\n@app.get(\"/\")\nasync def read_root():\n    return {\"message\": \"Hello World\"}\n```\n\nIn this example:\n\n1.  We define a `RequestLoggingMiddleware` class that inherits from `BaseHTTPMiddleware`.\n2.  Inside `dispatch`, we log the request method, path, and headers before calling `call_next(request)`.\n3.  `call_next(request)` passes the request to the next middleware or the route handler.\n4.  The response is then returned.\n\nThis middleware will log the request details for every incoming request before it reaches your route handlers.\n",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "text"
          }
        ],
        "usage": {
          "input_tokens": 3745,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 381,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 3745,
            "text_candidates_tokens": 381
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:52.718235+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "xoR9aZLXBYLtz7IPqZjc4AU",
        "finish_reason": "stop",
        "run_id": "ec3f95f0-d806-46f0-8478-60b3034f2045",
        "metadata": null
      }
    ],
    "source": "generated"
  },
  {
    "timestamp": "2026-01-30T20:28:01.312600",
    "agent_name": "fastapi_docs_agent",
    "system_prompt": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
    "model": "google-gla:gemini-2.0-flash-lite",
    "user_query": "What's the recommended way to write unit tests for FastAPI endpoints that have dependencies injected through the Depends() mechanism?",
    "response": "The recommended way to write unit tests for FastAPI endpoints with dependencies injected via `Depends()` is to use the `app.dependency_overrides` attribute. This allows you to override dependencies during testing.\n\nHere's how it works:\n\n1.  **Override Dependencies:** You can replace the original dependencies with mock or test implementations.\n2.  **Use `app.dependency_overrides`:** This is a dictionary where you map the original dependency function to your override function.\n3.  **Scope:** You can set the override at the beginning of the test and reset it at the end of the test function if you want to override a dependency only during some tests.\n4.  **Resetting Overrides:**  You can remove overrides by setting `app.dependency_overrides = {}`.\n\nExample:\n\n```python\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\ndef real_dependency():\n    return \"real_value\"\n\ndef test_dependency():\n    return \"test_value\"\n\n@app.get(\"/\")\nasync def route(value: str = Depends(real_dependency)):\n    return {\"value\": value}\n\ndef test_route():\n    app.dependency_overrides[real_dependency] = test_dependency\n    client = TestClient(app)\n    response = client.get(\"/\")\n    assert response.status_code == 200\n    assert response.json() == {\"value\": \"test_value\"}\n    app.dependency_overrides = {}\n```\n\nIn this example, `real_dependency` is replaced by `test_dependency` during the test, ensuring the test uses the mock value.\n",
    "messages": [
      {
        "parts": [
          {
            "content": "You are a helpful FastAPI documentation assistant. Your job is to answer questions about the FastAPI web framework accurately and thoroughly.\n\nWhen a user asks a question:\n1. Always search the documentation first before answering. Do not rely on your own knowledge alone.\n2. If the first search doesn't return useful results, try rephrasing the query or searching with different keywords.\n3. You may perform multiple searches to gather comprehensive information.\n4. Base your answers on the search results. Cite specific details from the docs.\n5. If the documentation doesn't cover the topic, say so honestly.\n\nKeep answers concise but complete. Use code examples from the docs when relevant.",
            "timestamp": "2026-01-31 04:27:57.724999+00:00",
            "dynamic_ref": null,
            "part_kind": "system-prompt"
          },
          {
            "content": "What's the recommended way to write unit tests for FastAPI endpoints that have dependencies injected through the Depends() mechanism?",
            "timestamp": "2026-01-31 04:27:57.725003+00:00",
            "part_kind": "user-prompt"
          }
        ],
        "timestamp": "2026-01-31 04:27:57.725145+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "c75c96a9-5ac6-4ad4-9421-4ca6ec90645d",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "args": {
              "query": "unit testing dependencies FastAPI"
            },
            "tool_call_id": "pyd_ai_3d403d2f1440439f83934e3a321aac82",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "tool-call"
          }
        ],
        "usage": {
          "input_tokens": 248,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 11,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 248,
            "text_candidates_tokens": 11
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:27:58.380119+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "zYR9acqQNL-sqtsPza--uQQ",
        "finish_reason": "stop",
        "run_id": "c75c96a9-5ac6-4ad4-9421-4ca6ec90645d",
        "metadata": null
      },
      {
        "parts": [
          {
            "tool_name": "search_fastapi_docs",
            "content": "[1] Source: fastapi-master/docs/en/docs/advanced/testing-dependencies.md\n# Testing Dependencies with Overrides { #testing-dependencies-with-overrides }\n\n## Overriding dependencies during testing { #overriding-dependencies-during-testing }\n\nThere are some scenarios where you might want to override a dependency during testing.\n\nYou don't want the original dependency to run (nor any of the sub-dependencies it might have).\n\nInstead, you want to provide a different dependency that will be used only during tests (possibly only some specific tests), and will provide a value that can be used where the value of the original dependency was used.\n\n### Use cases: external service { #use-cases-external-service }\n\nAn example could be that you have an external authentication provider that you need to call.\n\nYou send it a token and it returns an authenticated user.\n\nThis provider might be charging you per request, and calling it might take some extra time than if you had a fixed mock user for tests.\n\nYou probably want to test the external provider once, but not necessarily call it for every test that runs.\n\nIn this case, you can override the dependency that calls that provider, and use a custom dependency that returns a mock user, only for your tests.\n\n### Use the `app.dependency_overrides` attribute { #use-the-app-dependency-overrides-attribute }\n\nFor these cases, your **FastAPI** application has an attribute `app.dependency_overrides`, it is a simple `dict`.\n\nTo override a dependency for testing, you put as a key the original dependency (a function), and as the\n\n---\n\n[2] Source: fastapi-master/docs/de/docs/advanced/testing-dependencies.md\n# Testen mit \u00dcberschreibungen f\u00fcr Abh\u00e4ngigkeiten { #testing-dependencies-with-overrides }\n\n## Abh\u00e4ngigkeiten beim Testen \u00fcberschreiben { #overriding-dependencies-during-testing }\n\nEs gibt einige Szenarien, in denen Sie beim Testen m\u00f6glicherweise eine Abh\u00e4ngigkeit \u00fcberschreiben m\u00f6chten.\n\nSie m\u00f6chten nicht, dass die urspr\u00fcngliche Abh\u00e4ngigkeit ausgef\u00fchrt wird (und auch keine der m\u00f6glicherweise vorhandenen Unterabh\u00e4ngigkeiten).\n\nStattdessen m\u00f6chten Sie eine andere Abh\u00e4ngigkeit bereitstellen, die nur w\u00e4hrend Tests (m\u00f6glicherweise nur bei einigen bestimmten Tests) verwendet wird und einen Wert bereitstellt, der dort verwendet werden kann, wo der Wert der urspr\u00fcnglichen Abh\u00e4ngigkeit verwendet wurde.\n\n### Anwendungsf\u00e4lle: Externer Service { #use-cases-external-service }\n\nEin Beispiel k\u00f6nnte sein, dass Sie einen externen Authentifizierungsanbieter haben, mit dem Sie sich verbinden m\u00fcssen.\n\nSie senden ihm ein Token und er gibt einen authentifizierten Benutzer zur\u00fcck.\n\nDieser Anbieter berechnet Ihnen m\u00f6glicherweise Geb\u00fchren pro <abbr title=\"Request \u2013 Anfrage: Daten, die der Client zum Server sendet\">Request</abbr>, und der Aufruf k\u00f6nnte etwas l\u00e4nger dauern, als wenn Sie einen vordefinierten <abbr title=\"Platzhalter, vorget\u00e4uscht, zum Schein\">Mock</abbr>-Benutzer f\u00fcr Tests h\u00e4tten.\n\nSie m\u00f6chten den externen Anbieter wahrscheinlich einmal testen, ihn aber nicht unbedingt bei jedem weiteren ausgef\u00fchrten Test aufrufen.\n\nIn diesem Fall k\u00f6nnen Sie die Abh\u00e4ngigkeit, die diesen Anbieter aufruft,\n\n---\n\n[3] Source: fastapi-master/docs/ru/docs/advanced/testing-dependencies.md\n# \u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0435\u0439 \u0441 \u043f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f\u043c\u0438 { #testing-dependencies-with-overrides }\n\n## \u041f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0435\u0439 \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f { #overriding-dependencies-during-testing }\n\n\u0415\u0441\u0442\u044c \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u0438, \u043a\u043e\u0433\u0434\u0430 \u043c\u043e\u0436\u0435\u0442 \u043f\u043e\u043d\u0430\u0434\u043e\u0431\u0438\u0442\u044c\u0441\u044f \u043f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f.\n\n\u0412\u044b \u043d\u0435 \u0445\u043e\u0442\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u0438\u0441\u0445\u043e\u0434\u043d\u0430\u044f \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u043b\u0430\u0441\u044c (\u0438 \u043b\u044e\u0431\u044b\u0435 \u0435\u0451 \u043f\u043e\u0434\u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438 \u0442\u043e\u0436\u0435).\n\n\u0412\u043c\u0435\u0441\u0442\u043e \u044d\u0442\u043e\u0433\u043e \u0432\u044b \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0434\u0440\u0443\u0433\u0443\u044e \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0442\u0435\u0441\u0442\u043e\u0432 (\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e, \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0445 \u0442\u0435\u0441\u0442\u0430\u0445) \u0438 \u0431\u0443\u0434\u0435\u0442 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0442\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043c\u043e\u0436\u043d\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0432\u0435\u0437\u0434\u0435, \u0433\u0434\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043b\u043e\u0441\u044c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0439 \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u0438.\n\n### \u0412\u0430\u0440\u0438\u0430\u043d\u0442\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f: \u0432\u043d\u0435\u0448\u043d\u0438\u0439 \u0441\u0435\u0440\u0432\u0438\u0441 { #use-cases-external-service }\n\n\u041f\u0440\u0438\u043c\u0435\u0440: \u0443 \u0432\u0430\u0441 \u0435\u0441\u0442\u044c \u0432\u043d\u0435\u0448\u043d\u0438\u0439 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438, \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u043c\u0443 \u043d\u0443\u0436\u043d\u043e \u043e\u0431\u0440\u0430\u0449\u0430\u0442\u044c\u0441\u044f.\n\n\u0412\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0435 \u0435\u043c\u0443 \u0442\u043e\u043a\u0435\u043d, \u0430 \u043e\u043d \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f.\n\n\u0422\u0430\u043a\u043e\u0439 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440 \u043c\u043e\u0436\u0435\u0442 \u0431\u0440\u0430\u0442\u044c \u043f\u043b\u0430\u0442\u0443 \u0437\u0430 \u043a\u0430\u0436\u0434\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441, \u0438 \u0435\u0433\u043e \u0432\u044b\u0437\u043e\u0432 \u043c\u043e\u0436\u0435\u0442 \u0437\u0430\u043d\u0438\u043c\u0430\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438, \u0447\u0435\u043c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0444\u0438\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u043c\u043e\u043a-\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0434\u043b\u044f \u0442\u0435\u0441\u0442\u043e\u0432.\n\n\u0412\u0435\u0440\u043e\u044f\u0442\u043d\u043e, \u0432\u044b \u0437\u0430\u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u0440\u043e\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u043d\u0435\u0448\u043d\u0438\u0439 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440 \u043e\u0434\u0438\u043d \u0440\u0430\u0437, \u043d\u043e \u043d\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c \u0435\u0433\u043e \u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c\u043e\u0433\u043e \u0442\u0435\u0441\u0442\u0430.\n\n\u0412 \u0442\u0430\u043a\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435 \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u0435\u0440\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u0442\u0441\u044f \u043a \u044d\u0442\u043e\u043c\u0443 \u043f\u0440\u043e\u0432\u0430\u0439\u0434\u0435\u0440\u0443, \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0431\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u0437\u0430\u0432\u0438\u0441\u0438\u043c\u043e\u0441\u0442\u044c, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u044e\u0449\u0443\u044e \u043c\u043e\u043a-\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0432\u0430\u0448\u0438\u0445 \u0442\u0435\u0441\u0442\u043e\u0432.\n\n### \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0430\u0442\u0440\u0438\u0431\u0443\u0442 `app.dependency_overrides` { #use-the-app-dependency-overrides-attribute }\n\n\u0414\u043b\u044f \u0442\u0430\u043a\u0438\u0445 \u0441\u043b\u0443\u0447\u0430\u0435\u0432 \u0443 \u0432\u0430\u0448\u0435\u0433\u043e \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f **FastAPI*\n\n---\n\n[4] Source: fastapi-master/docs/es/docs/advanced/testing-dependencies.md\n# Probando Dependencias con Overrides { #testing-dependencies-with-overrides }\n\n## Sobrescribir dependencias durante las pruebas { #overriding-dependencies-during-testing }\n\nHay algunos escenarios donde podr\u00edas querer sobrescribir una dependencia durante las pruebas.\n\nNo quieres que la dependencia original se ejecute (ni ninguna de las sub-dependencias que pueda tener).\n\nEn cambio, quieres proporcionar una dependencia diferente que se usar\u00e1 solo durante las pruebas (posiblemente solo algunas pruebas espec\u00edficas), y que proporcionar\u00e1 un valor que pueda ser usado donde se us\u00f3 el valor de la dependencia original.\n\n### Casos de uso: servicio externo { #use-cases-external-service }\n\nUn ejemplo podr\u00eda ser que tienes un proveedor de autenticaci\u00f3n externo al que necesitas llamar.\n\nLe env\u00edas un token y te devuelve un usuario autenticado.\n\nEste proveedor podr\u00eda estar cobr\u00e1ndote por cada request, y llamarlo podr\u00eda tomar m\u00e1s tiempo adicional que si tuvieras un usuario de prueba fijo para los tests.\n\nProbablemente quieras probar el proveedor externo una vez, pero no necesariamente llamarlo para cada test que se realice.\n\nEn este caso, puedes sobrescribir la dependencia que llama a ese proveedor y usar una dependencia personalizada que devuelva un usuario de prueba, solo para tus tests.\n\n### Usa el atributo `app.dependency_overrides` { #use-the-app-dependency-overrides-attribute }\n\nPara estos casos, tu aplicaci\u00f3n **FastAPI** tiene un atributo `app.dependency_overrides`, es un simple `dict`\n\n---\n\n[5] Source: fastapi-master/docs/pt/docs/advanced/testing-dependencies.md\n# Testando Depend\u00eancias com Sobreposi\u00e7\u00f5es { #testing-dependencies-with-overrides }\n\n## Sobrepondo depend\u00eancias durante os testes { #overriding-dependencies-during-testing }\n\nExistem alguns cen\u00e1rios onde voc\u00ea deseje sobrepor uma depend\u00eancia durante os testes.\n\nVoc\u00ea n\u00e3o quer que a depend\u00eancia original execute (e nenhuma das subdepend\u00eancias que voc\u00ea possa ter).\n\nEm vez disso, voc\u00ea deseja fornecer uma depend\u00eancia diferente que ser\u00e1 usada somente durante os testes (possivelmente apenas para alguns testes espec\u00edficos) e fornecer\u00e1 um valor que pode ser usado onde o valor da depend\u00eancia original foi usado.\n\n### Casos de uso: servi\u00e7o externo { #use-cases-external-service }\n\nUm exemplo pode ser que voc\u00ea possua um provedor de autentica\u00e7\u00e3o externo que voc\u00ea precisa chamar.\n\nVoc\u00ea envia ao servi\u00e7o um *token* e ele retorna um usu\u00e1rio autenticado.\n\nEste provedor pode cobrar por requisi\u00e7\u00e3o, e cham\u00e1-lo pode levar mais tempo do que se voc\u00ea tivesse um usu\u00e1rio fixo para os testes.\n\nVoc\u00ea provavelmente quer testar o provedor externo uma vez, mas n\u00e3o necessariamente cham\u00e1-lo em todos os testes que executarem.\n\nNeste caso, voc\u00ea pode sobrepor (*override*) a depend\u00eancia que chama o provedor, e utilizar uma depend\u00eancia customizada que retorna um *mock* do usu\u00e1rio, apenas para os seus testes.\n\n### Utilize o atributo `app.dependency_overrides` { #use-the-app-dependency-overrides-attribute }\n\nPara estes casos, a sua aplica\u00e7\u00e3o **FastAPI** possui o atributo `app.dependency_overrides`. Ele \u00e9 um simples `dict`.\n\n---\n\n[6] Source: fastapi-master/docs/en/docs/release-notes.md\npull/4972) by [@aboubacs](https://github.com/aboubacs).\n* \ud83d\udc1b Reenable `allow_arbitrary_types` when only 1 argument is used on the API endpoint. PR [#13694](https://github.com/fastapi/fastapi/pull/13694) by [@rmawatson](https://github.com/rmawatson).\n* \ud83d\udc1b Fix `inspect.getcoroutinefunction()` can break testing with `unittest.mock.patch()`. PR [#14022](https://github.com/fastapi/fastapi/pull/14022) by [@secrett2633](https://github.com/secrett2633).\n\n### Refactors\n\n* \u267b\ufe0f Create `dependency-cache` dict in `solve_dependencies` only if `None` (don't re-create if empty). PR [#13689](https://github.com/fastapi/fastapi/pull/13689) by [@bokshitsky](https://github.com/bokshitsky).\n* \u2705 Enable test case for duplicated headers in `test_tutorial/test_header_params/test_tutorial003.py`. PR [#13864](https://github.com/fastapi/fastapi/pull/13864) by [@Amogha-ark](https://github.com/Amogha-ark).\n* \ud83d\udccc Pin `httpx` to `>=0.23.0,<1.0.0`. PR [#14086](https://github.com/fastapi/fastapi/pull/14086) by [@YuriiMotov](https://github.com/YuriiMotov).\n\n### Docs\n\n* \ud83d\udcdd Add note about Cookies and JavaScript on `tutorial/cookie-params.md`. PR [#13510](https://github.com/fastapi/fastapi/pull/13510) by [@Kludex](https://github.com/Kludex).\n* \ud83d\udcdd Remove outdated formatting from `path-params-numeric-validations.md` for languages `en`, `es` and `uk`.. PR [#14059](https://github.com/fastapi/fastapi/pull/14059) by [@svlandeg](https://github.com/svlandeg).\n* \ud83d\udcdd Fix and Improve English Documentation. PR [#14048](https://github.\n\n---\n\n[7] Source: fastapi-master/docs/en/docs/advanced/testing-dependencies.md\n call it for every test that runs.\n\nIn this case, you can override the dependency that calls that provider, and use a custom dependency that returns a mock user, only for your tests.\n\n### Use the `app.dependency_overrides` attribute { #use-the-app-dependency-overrides-attribute }\n\nFor these cases, your **FastAPI** application has an attribute `app.dependency_overrides`, it is a simple `dict`.\n\nTo override a dependency for testing, you put as a key the original dependency (a function), and as the value, your dependency override (another function).\n\nAnd then **FastAPI** will call that override instead of the original dependency.\n\n{* ../../docs_src/dependency_testing/tutorial001_an_py310.py hl[26:27,30] *}\n\n/// tip\n\nYou can set a dependency override for a dependency used anywhere in your **FastAPI** application.\n\nThe original dependency could be used in a *path operation function*, a *path operation decorator* (when you don't use the return value), a `.include_router()` call, etc.\n\nFastAPI will still be able to override it.\n\n///\n\nThen you can reset your overrides (remove them) by setting `app.dependency_overrides` to be an empty `dict`:\n\n```Python\napp.dependency_overrides = {}\n```\n\n/// tip\n\nIf you want to override a dependency only during some tests, you can set the override at the beginning of the test (inside the test function) and reset it at the end (at the end of the test function).\n\n///\n\n---\n\n[8] Source: fastapi-master/docs/en/docs/advanced/advanced-dependencies.md\nmeter in your *path operation function* later.\n\n## Parameterize the instance { #parameterize-the-instance }\n\nAnd now, we can use `__init__` to declare the parameters of the instance that we can use to \"parameterize\" the dependency:\n\n{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[9] *}\n\nIn this case, **FastAPI** won't ever touch or care about `__init__`, we will use it directly in our code.\n\n## Create an instance { #create-an-instance }\n\nWe could create an instance of this class with:\n\n{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[18] *}\n\nAnd that way we are able to \"parameterize\" our dependency, that now has `\"bar\"` inside of it, as the attribute `checker.fixed_content`.\n\n## Use the instance as a dependency { #use-the-instance-as-a-dependency }\n\nThen, we could use this `checker` in a `Depends(checker)`, instead of `Depends(FixedContentQueryChecker)`, because the dependency is the instance, `checker`, not the class itself.\n\nAnd when solving the dependency, **FastAPI** will call this `checker` like:\n\n```Python\nchecker(q=\"somequery\")\n```\n\n...and pass whatever that returns as the value of the dependency in our *path operation function* as the parameter `fixed_content_included`:\n\n{* ../../docs_src/dependencies/tutorial011_an_py39.py hl[22] *}\n\n/// tip\n\nAll this might seem contrived. And it might not be very clear how is it useful yet.\n\nThese examples are intentionally simple, but show how it all works.\n\nIn the chapters about security, there are utility functio\n\n---\n\n[9] Source: fastapi-master/docs/en/docs/release-notes.md\ncy-multiple-times).\n    * PR [#292](https://github.com/tiangolo/fastapi/pull/292).\n\n* Implement dependency overrides for testing.\n    * This allows using overrides/mocks of dependencies during tests.\n    * New docs: [Testing Dependencies with Overrides](https://fastapi.tiangolo.com/advanced/testing-dependencies/).\n    * PR [#291](https://github.com/tiangolo/fastapi/pull/291).\n\n## 0.27.2\n\n* Fix path and query parameters receiving `dict` as a valid type. It should be mapped to a body payload. PR [#287](https://github.com/tiangolo/fastapi/pull/287). Updated docs at: [Query parameter list / multiple values with defaults: Using `list`](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/#using-list).\n\n## 0.27.1\n\n* Fix `auto_error=False` handling in `HTTPBearer` security scheme. Do not `raise` when there's an incorrect `Authorization` header if `auto_error=False`. PR [#282](https://github.com/tiangolo/fastapi/pull/282).\n\n* Fix type declaration of `HTTPException`. PR [#279](https://github.com/tiangolo/fastapi/pull/279).\n\n## 0.27.0\n\n* Fix broken link in docs about OAuth 2.0 with scopes. PR [#275](https://github.com/tiangolo/fastapi/pull/275) by [@dmontagu](https://github.com/dmontagu).\n\n* Refactor param extraction using Pydantic `Field`:\n    * Large refactor, improvement, and simplification of param extraction from *path operations*.\n    * Fix/add support for list *query parameters* with list defaults. New documentation: [Query parameter list / multiple values with def",
            "tool_call_id": "pyd_ai_3d403d2f1440439f83934e3a321aac82",
            "metadata": null,
            "timestamp": "2026-01-31 04:27:58.470462+00:00",
            "part_kind": "tool-return"
          }
        ],
        "timestamp": "2026-01-31 04:27:58.470759+00:00",
        "instructions": null,
        "kind": "request",
        "run_id": "c75c96a9-5ac6-4ad4-9421-4ca6ec90645d",
        "metadata": null
      },
      {
        "parts": [
          {
            "content": "The recommended way to write unit tests for FastAPI endpoints with dependencies injected via `Depends()` is to use the `app.dependency_overrides` attribute. This allows you to override dependencies during testing.\n\nHere's how it works:\n\n1.  **Override Dependencies:** You can replace the original dependencies with mock or test implementations.\n2.  **Use `app.dependency_overrides`:** This is a dictionary where you map the original dependency function to your override function.\n3.  **Scope:** You can set the override at the beginning of the test and reset it at the end of the test function if you want to override a dependency only during some tests.\n4.  **Resetting Overrides:**  You can remove overrides by setting `app.dependency_overrides = {}`.\n\nExample:\n\n```python\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\ndef real_dependency():\n    return \"real_value\"\n\ndef test_dependency():\n    return \"test_value\"\n\n@app.get(\"/\")\nasync def route(value: str = Depends(real_dependency)):\n    return {\"value\": value}\n\ndef test_route():\n    app.dependency_overrides[real_dependency] = test_dependency\n    client = TestClient(app)\n    response = client.get(\"/\")\n    assert response.status_code == 200\n    assert response.json() == {\"value\": \"test_value\"}\n    app.dependency_overrides = {}\n```\n\nIn this example, `real_dependency` is replaced by `test_dependency` during the test, ensuring the test uses the mock value.\n",
            "id": null,
            "provider_name": null,
            "provider_details": null,
            "part_kind": "text"
          }
        ],
        "usage": {
          "input_tokens": 3940,
          "cache_write_tokens": 0,
          "cache_read_tokens": 0,
          "output_tokens": 353,
          "input_audio_tokens": 0,
          "cache_audio_read_tokens": 0,
          "output_audio_tokens": 0,
          "details": {
            "text_prompt_tokens": 3940,
            "text_candidates_tokens": 353
          }
        },
        "model_name": "gemini-2.0-flash-lite",
        "timestamp": "2026-01-31 04:28:01.311871+00:00",
        "kind": "response",
        "provider_name": "google-gla",
        "provider_url": "https://generativelanguage.googleapis.com/",
        "provider_details": {
          "finish_reason": "STOP"
        },
        "provider_response_id": "zoR9aeyPJPiK6dkPpom74Ac",
        "finish_reason": "stop",
        "run_id": "c75c96a9-5ac6-4ad4-9421-4ca6ec90645d",
        "metadata": null
      }
    ],
    "source": "generated"
  }
]